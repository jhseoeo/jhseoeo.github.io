import{S as Ni,i as hi,s as Ki,k as p,a as r,q as c,l as o,c as u,m as l,h as n,r as i,n as k,U as ns,b as t,E as e,M as Cl}from"./index.d78780bf.js";function Vi(ii){let ws,ka,fa,P,T,dn,ze,Ea,ma,va,bs,Ge,Ca,Sa,da,_a,W,I,_n,Le,wa,ba,ya,ys,Ue,Ra,Rs,Fe,Aa,As,Xe,Pa,Ta,Wa,Ps,Ye,Ia,Ts,wn,Ws,Sl,Na,Is,Je,ha,Ns,Qe,Ka,Va,Ba,ja,N,h,bn,Ze,Ma,hs,$e,Da,Ks,yn,Vs,dl,xa,Bs,ge,Ha,js,sp,Oa,Ms,np,qa,za,Ga,La,K,V,Rn,ap,Ua,Ds,tp,Fa,xs,as,Hs,_l,ep,ts,pp,es,op,lp,Xa,Os,cp,Ya,Ja,Qa,Za,B,j,An,ip,$a,qs,Pn,zs,wl,ga,Gs,rp,st,nt,at,tt,M,D,Tn,up,et,pt,ot,Ls,kp,lt,Us,fp,ct,Fs,Wn,Xs,bl,it,rt,ut,x,Ep,ps,mp,vp,kt,Ys,In,Js,yl,ft,d,Cp,Nn,Sp,dp,hn,_p,wp,Et,Qs,Kn,Zs,Rl,mt,vt,Ct,$s,bp,St,gs,yp,dt,sn,Vn,nn,Al,_t,an,Rp,wt,bt,yt,Rt,H,O,Bn,Ap,At,Pt,Tt,_,Pp,os,Tp,Wp,ls,Ip,Np,Wt,v,hp,jn,Kp,Vp,Mn,Bp,jp,Dn,Mp,Dp,It,tn,xp,Nt,en,Hp,ht,Kt,Vt,Bt,q,z,xn,Op,jt,Mt,Dt,pn,qp,xt,G,zp,cs,Gp,Lp,Ht,Ot,qt,zt,L,U,Hn,Up,Gt,on,Fp,Lt,F,Xp,On,Yp,Jp,Ut,E,Qp,qn,Zp,$p,zn,gp,so,Gn,no,ao,Ln,to,eo,Ft,is,ri=`<code class="language-javascript"><span class="token keyword">const</span> kinesisVideo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-sdk/clients/kinesisvideo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> SigV4RequestSigner <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'amazon-kinesis-video-streams-webrtc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SigV4RequestSigner<span class="token punctuation">;</span>
<span class="token keyword">const</span> KinesisVideoSignalingChannels <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-sdk/clients/kinesisvideosignalingchannels'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`,Xt,ln,po,Yt,rs,ui=`<code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">KinesisUtil</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// AWS IAM Credential Data</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>credential <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">region</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">KINESIS_REGION</span><span class="token punctuation">,</span>
            <span class="token literal-property property">accessKeyId</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">KINESIS_ACCESS_KEY_ID</span><span class="token punctuation">,</span>
            <span class="token literal-property property">secretAccessKey</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">KINESIS_SECRET_ACCESS_KEY</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>kinesisClient<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>kinesisClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">kinesisVideo</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>credential <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"An error is occured creating Kinesis Client"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token operator">...</span></code>`,Jt,Qt,Zt,cn,oo,$t,us,ki=`<code class="language-javascript"><span class="token comment">/**
 * Creates channel
 * @param &#123;string&#125; ChannelName - Name of the channel
 * @param &#123;string&#125; role - Role of the channel
 * @param &#123;string&#125; clientId - Id of peer. Only vewer needs it
 * @returns &#123;&#123;errorCode:number&#125;&#125; An object contains information about request, which includes Error Code
 */</span>
<span class="token keyword">async</span> <span class="token function">createChannel</span><span class="token punctuation">(</span>ChannelName<span class="token punctuation">,</span> role <span class="token operator">=</span> <span class="token string">"VIEWER"</span><span class="token punctuation">,</span> clientId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  	<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">errorCode</span><span class="token operator">:</span> <span class="token number">400</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
		<span class="token comment">// CHECK IF THE CHANNEL ALREADY EXISTS</span>
		<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kinesisClient
			<span class="token punctuation">.</span><span class="token function">listSignalingChannels</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
				<span class="token literal-property property">ChannelNameCondition</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
					<span class="token literal-property property">ComparisonOperator</span><span class="token operator">:</span> <span class="token string">"BEGINS_WITH"</span><span class="token punctuation">,</span>
					<span class="token literal-property property">ComparisonValue</span><span class="token operator">:</span> ChannelName<span class="token punctuation">,</span>
				<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">MaxResults</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>ChannelInfoList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token comment">// CHANNEL ALREADY EXISTS</span>
			console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Channel already exists:"</span><span class="token punctuation">,</span> ChannelName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
			<span class="token comment">// CREATE NEW CHANNEL</span>
			<span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kinesisClient<span class="token punctuation">.</span><span class="token function">createSignalingChannel</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> ChannelName <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>

		<span class="token keyword">const</span> describeSignalingChannelResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kinesisClient
			<span class="token punctuation">.</span><span class="token function">describeSignalingChannel</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> ChannelName <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> channelInfo <span class="token operator">=</span> describeSignalingChannelResponse<span class="token punctuation">.</span>ChannelInfo<span class="token punctuation">;</span>

		<span class="token operator">...</span></code>`,gt,rn,lo,se,ks,fi=`<code class="language-javascript"><span class="token operator">...</span>

<span class="token keyword">const</span> endpointsByProtocol <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listEndpoints</span><span class="token punctuation">(</span>channelInfo<span class="token punctuation">.</span>ChannelARN<span class="token punctuation">,</span> role<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>endpointsByProtocol<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	result<span class="token punctuation">.</span>errorCode <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> iceServers <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listICEServers</span><span class="token punctuation">(</span>channelInfo<span class="token punctuation">.</span>ChannelARN<span class="token punctuation">,</span> endpointsByProtocol<span class="token punctuation">.</span><span class="token constant">HTTPS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>iceServers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	result<span class="token punctuation">.</span>errorCode <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> configuration <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	iceServers<span class="token punctuation">,</span>
	<span class="token literal-property property">iceTransportPolicy</span><span class="token operator">:</span> <span class="token string">'all'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token operator">...</span></code>`,ne,un,co,ae,fs,Ei=`<code class="language-javascript">		<span class="token keyword">let</span> queryParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
			<span class="token string-property property">"X-Amz-ChannelARN"</span><span class="token operator">:</span> channelInfo<span class="token punctuation">.</span>ChannelARN<span class="token punctuation">,</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>clientId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			queryParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
				<span class="token operator">...</span>queryParams<span class="token punctuation">,</span>
				<span class="token string-property property">"X-Amz-ClientId"</span><span class="token operator">:</span> clientId<span class="token punctuation">,</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>

		<span class="token keyword">const</span> signer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SigV4RequestSigner</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">KINESIS_REGION</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>credential<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">await</span> signer<span class="token punctuation">.</span><span class="token function">getSignedURL</span><span class="token punctuation">(</span>endpointsByProtocol<span class="token punctuation">.</span><span class="token constant">WSS</span><span class="token punctuation">,</span> queryParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Kinesis created channel ARN:"</span><span class="token punctuation">,</span> channelInfo<span class="token punctuation">.</span>ChannelARN<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token punctuation">&#123;</span> configuration<span class="token punctuation">,</span> url<span class="token punctuation">,</span> role <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> response<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"An error is occured creating channel"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code>`,te,X,io,Un,ro,uo,ee,pe,oe,kn,ko,le,Es,mi=`<code class="language-javascript"><span class="token keyword">async</span> <span class="token function">getChannelInfo</span><span class="token punctuation">(</span><span class="token parameter">ChannelName<span class="token punctuation">,</span> role<span class="token punctuation">,</span> clientId <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> describeSignalingChannelResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kinesisClient
		<span class="token punctuation">.</span><span class="token function">describeSignalingChannel</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> ChannelName <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> channelInfo <span class="token operator">=</span> describeSignalingChannelResponse<span class="token punctuation">.</span>ChannelInfo<span class="token punctuation">;</span>

	<span class="token keyword">const</span> endpointsByProtocol <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listEndpoints</span><span class="token punctuation">(</span>channelInfo<span class="token punctuation">.</span>ChannelARN<span class="token punctuation">,</span> role<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>endpointsByProtocol<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		result<span class="token punctuation">.</span>errorCode <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">const</span> iceServers <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">listICEServers</span><span class="token punctuation">(</span>channelInfo<span class="token punctuation">.</span>ChannelARN<span class="token punctuation">,</span> endpointsByProtocol<span class="token punctuation">.</span><span class="token constant">HTTPS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>iceServers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		result<span class="token punctuation">.</span>errorCode <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">const</span> configuration <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
		iceServers<span class="token punctuation">,</span>
		<span class="token literal-property property">iceTransportPolicy</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

	<span class="token keyword">let</span> queryParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
		<span class="token string-property property">"X-Amz-ChannelARN"</span><span class="token operator">:</span> channelInfo<span class="token punctuation">.</span>ChannelARN<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>clientId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		queryParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
			<span class="token operator">...</span>queryParams<span class="token punctuation">,</span>
			<span class="token string-property property">"X-Amz-ClientId"</span><span class="token operator">:</span> clientId<span class="token punctuation">,</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">const</span> signer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SigV4RequestSigner</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">KINESIS_REGION</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>credential<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">await</span> signer<span class="token punctuation">.</span><span class="token function">getSignedURL</span><span class="token punctuation">(</span>endpointsByProtocol<span class="token punctuation">.</span><span class="token constant">WSS</span><span class="token punctuation">,</span> queryParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token punctuation">&#123;</span> configuration<span class="token punctuation">,</span> url<span class="token punctuation">,</span> role <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code>`,ce,fn,fo,ie,re,ue,En,Eo,ke,ms,vi=`<code class="language-javascript"><span class="token keyword">async</span> <span class="token function">deleteChannel</span><span class="token punctuation">(</span><span class="token parameter">ChannelName</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> describeSignalingChannelResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kinesisClient
		<span class="token punctuation">.</span><span class="token function">describeSignalingChannel</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> ChannelName <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> ChannelARN <span class="token operator">=</span> describeSignalingChannelResponse<span class="token punctuation">.</span>ChannelInfo<span class="token punctuation">.</span>ChannelARN<span class="token punctuation">;</span>

	<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kinesisClient<span class="token punctuation">.</span><span class="token function">deleteSignalingChannel</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> ChannelARN <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"An error is occured deleting channel"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`,fe,Ee,me,ve,Y,J,Fn,mo,Ce,m,vo,Xn,Co,So,Yn,_o,wo,Jn,bo,yo,Qn,Ro,Ao,Se,C,Po,Zn,To,Wo,$n,Io,No,gn,ho,Ko,de,vs,Ci=`<code class="language-javascript"><span class="token comment">/**
 * Create WebRTC Signaling Channel and get info about the channel
 * @returns &#123;Promise&lt;Response>&#125; - Info about Channel
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createSignalingChannel</span><span class="token punctuation">(</span><span class="token parameter">channelName</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_APP_PROXY_HOST</span> <span class="token operator">+</span> <span class="token string">'/channel/'</span> <span class="token operator">+</span> channelName<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
		<span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
			<span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> channel<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> createSignalingChannel<span class="token punctuation">;</span></code>`,_e,y,sa,Vo,Bo,na,jo,Mo,we,f,aa,Do,xo,ta,Ho,Oo,ea,qo,zo,pa,Go,Lo,oa,Uo,Fo,be,Cs,Si=`<code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">CustomSigner</span> <span class="token punctuation">&#123;</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">_url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> _url<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token function">getSignedURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`,ye,Q,Xo,la,Yo,Jo,Re,Ss,di=`<code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>signalingClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SignalingClient</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">requestSigner</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CustomSigner</span><span class="token punctuation">(</span>kinesisInfo<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token operator">...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`,Ae,mn,Qo,Pe,vn,Zo,Te,We,Ie,Ne,Z,$,ca,$o,he,Ke,Ve,R,go,sl,nl,ds,al,Be,A,tl,el,pl,_s,ol;return{c(){ws=p("br"),ka=p("br"),fa=r(),P=p("h2"),T=p("a"),dn=p("span"),ze=c("Introduction"),Ea=r(),ma=p("hr"),va=r(),bs=p("p"),Ge=c(`학교 캡스톤디자인 프로젝트를 진행중인데,
WebRTC 연결 설정 및 단방향 WebRTC 비디오 영상 전달을 위해 AWS Kinesis Video Stream를 사용하게 되었다.
AWS Kinesis Video Stream에 대해 이것저것 조사해보면서 알게 된 것들과, 단방향 WebRTC 비디오 영상 전달 예제를 만들기까지의 과정을 기록해보았다.`),Ca=r(),Sa=p("br"),da=p("br"),_a=r(),W=p("h2"),I=p("a"),_n=p("span"),Le=c("AWS Kinesis Video Stream"),wa=r(),ba=p("hr"),ya=r(),ys=p("p"),Ue=c(`AWS Kinesis Video Streams는 Fully-Managed AWS 서비스이다.
해당 서비스를 통해 실시간 비디오를 디바이스로부터 AWS 클라우드로 스트리밍하는 데 사용하거나,
실시간 영상 처리나 일괄적인 영상 분석을 하는 어플리케이션을 구축할 수 있다.`),Ra=r(),Rs=p("p"),Fe=c(`먼저, 실시간 또는 녹화된 비디오 스트림은 모바일이나 브라우저 환경에서도 재생할 수 있다.
그리고 WebRTC를 통한 P2P 및 양방향 통신을 지원하기 때문에,
WebRTC로 전송된 Amazon Kinesis Video Streams의 실시간 비디오 스트림을 브라우저 환경에서 재생할 수 있게 된다.
이때 특별한 설정 없이도 WebRTC의 STUN, TURN, ICE 서버의 복잡한 기능 설정을 자동으로 해주기 때문에 유용하다.
특히 P2P를 지원하지 않아 TURN 서버로 데이터를 릴레이 해야하는 경우에도, AWS의 infrastructure를 사용하기 떄문에 백엔드 로드를 줄일 수 있다.`),Aa=r(),As=p("p"),Xe=c(`Fully-Managed이기 때문에 Amazon Kinesis Video Streams의 underlying infrastructure에 대하여 고민할 필요가 없어진다.
Amazon Kinesis Video Streams는 스트리밍되는 비디오 데이터가 클수록 매체로부터 스트리밍 데이터를 수집하는데 필요한 underlying infrastructure를 자동으로 provisioning하여 scale up해준다.`),Pa=r(),Ta=p("br"),Wa=r(),Ps=p("p"),Ye=c("AWS Kinesis Video Streams가 제공하는 서비스는 두 종류로 구분할 수 있다."),Ia=r(),Ts=p("center"),wn=p("p"),Ws=p("img"),Na=r(),Is=p("p"),Je=c(`하나는 real-time 및 batch processing을 위해 Video Streams을 지원하는 서비스이다.
Media source에서 수집한 영상을 sdk를 통해 kinesis video streams로 전송함으로써
비디오 스트림 데이터들이 수집되고, 지속적으로 저장, 암호화, 인덱싱되어 real-time 및 batch processing을 할 수 있다.
이후 단순 비디오 재생 뿐 아니라 video processing, machine learning을 위해 사용할 수 있다.`),ha=r(),Ns=p("p"),Qe=c(`또 하나는 WebRTC signaling channels을 제공하는 서비스이다.
장치나 웹 플랫폼의 소스로부터 캡쳐된 비디오 스트림 데이터는 WebRTC를 통해 전달되며, Real-time 및 양방향 통신을 지원한다.
따라서 낮은 latency에서 P2P streaming을 할 수 있게 된다.`),Ka=r(),Va=p("br"),Ba=p("br"),ja=r(),N=p("h3"),h=p("a"),bn=p("span"),Ze=c("Kinesis video stream"),Ma=r(),hs=p("p"),$e=c("Kinesis video stream의 구조는 다음과 같다."),Da=r(),Ks=p("center"),yn=p("p"),Vs=p("img"),xa=r(),Bs=p("p"),ge=c("Producer는 Kinesis video stream에 비디오 스트림을 넣는 주체로써, 주로 AWS SDK를 통해 데이터를 집어넣는다."),Ha=r(),js=p("p"),sp=c(`Consumer는 Kinesis video stream에서 읽어온 데이터를 통해 분석하거나 비디오 스트림을 재생하는 역할을 한다.
이 단계에서 real-time 또는 batch processing이 일어날 수 있을 것이다.`),Oa=r(),Ms=p("p"),np=c(`Kinesis video stream는 비디오 스트림을 전송하고, 저장하고, processing을 할 수 있게끔 하는 리소스이다.
하나의 producer만 값을 집어넣고, 한 개 이상의 Consumer가 값을 읽어들이는 것이 일반적인 구조이다.`),qa=r(),za=p("br"),Ga=p("br"),La=r(),K=p("h3"),V=p("a"),Rn=p("span"),ap=c("WebRTC signaling channels"),Ua=r(),Ds=p("p"),tp=c("WebRTC signaling channels의 구조는 다음과 같다."),Fa=r(),xs=p("center"),as=p("p"),Hs=p("img"),ep=r(),ts=p("em"),pp=c("출처 : "),es=p("a"),op=c("https://tech.cloud.nongshim.co.kr/2021/04/02/매뉴얼-kinesis-video-streams-whith-webrtc-생성하기"),lp=c("/"),Xa=r(),Os=p("p"),cp=c(`Master client가 WebRTC signaling channel을 생성하면,
Master client와 Viewer client는 생성된 WebRTC signaling channel을 통해 서로 데이터를 주고받는다.
각 채널당 하나의 Master, 하나 이상의 Viewer가 존재하는 것이 일반적이다.`),Ya=r(),Ja=p("br"),Qa=p("br"),Za=r(),B=p("h3"),j=p("a"),An=p("span"),ip=c("System Requirement"),$a=r(),qs=p("center"),Pn=p("p"),zs=p("img"),ga=r(),Gs=p("p"),rp=c(`Docker 컨테이너나 Raspberry Pi와 같이 제한된 컴퓨팅 능력을 가진 환경에서도
Amazon Kinesis Video Streams을 통해 문제없이 Real-Time Streaming을 수행할 수 있다고 한다.
Amazon Kinesis Video Streams을 사용하면 낮은 시스템 요구사항에서도 서비스를 제공하는 데에는 지장이 없을 것이다.`),st=r(),nt=p("br"),at=p("br"),tt=r(),M=p("h2"),D=p("a"),Tn=p("span"),up=c("Getting Started"),et=r(),pt=p("hr"),ot=r(),Ls=p("p"),kp=c("우리는 위 두 종류의 서비스 중, KVS WebRTC Signaling Channel을 테스트해볼 것이다."),lt=r(),Us=p("p"),fp=c("일단 IAM에서 KVS 관련된 권한 설정을 해준다. 본인은 managed policy로 전체 권한을 허용해주었다."),ct=r(),Fs=p("center"),Wn=p("p"),Xs=p("img"),it=r(),rt=p("br"),ut=r(),x=p("p"),Ep=c("이제, "),ps=p("a"),mp=c("테스트 페이지"),vp=c("에서 채널을 생성해보자. 테스트 페이지에 들어가보면 대충 이렇게 생겼다."),kt=r(),Ys=p("center"),In=p("p"),Js=p("img"),ft=r(),d=p("p"),Cp=c("여기서 Region id 및 AWS Credentials을 적당히 작성해주고, 원하는 Channel Name을 부여한 뒤 "),Nn=p("em"),Sp=c("Create Channel"),dp=c(` 버튼으로 채널을 생성해보자.
성공적으로 채널이 생성되었다면, 하단 로그에 `),hn=p("code"),_p=c("Channel ARN"),wp=c(`이 출력되었을 것이다.
그리고 AWS Kinesis Video Streams 대시보드의 Signaling channels 탭에 들어가보면, 채널이 생성된 것을 확인할 수 있다.`),Et=r(),Qs=p("center"),Kn=p("p"),Zs=p("img"),mt=r(),vt=p("br"),Ct=r(),$s=p("p"),bp=c(`이제 생성된 채널에서 통신을 해보자.
브라우저 창을 두 개 키고(같은 컴퓨터에 두 개를 켜도 되지만, 서로 다른 컴퓨터에서 하나씩 키는 게 테스트 환경으로서는 더 적합할 것이다),
설정을 따로 안 건드린 상태에서 각각 하나는 MASTER로, 하나는 VIEWER로 켜볼 것이다.`),St=r(),gs=p("p"),yp=c(`한 쪽 브라우저에서 먼저 Start Master로 채널을 연 뒤 다른 쪽 브라우저에서 Start Viewer로 채널에 접속하면 된다.
아래 사진은 Master 쪽에서 찍은 사진이다.`),dt=r(),sn=p("center"),Vn=p("p"),nn=p("img"),_t=r(),an=p("p"),Rp=c(`이후 설정에 따라 비디오 전송 여부, 오디오 전송 여부, Datachannel 생성 여부 등을 결정할 수 있으며,
STUN, TURN 등 사용 여부, Trickle ICE 사용 어부 등을 결정할 수 있다.`),wt=r(),bt=p("br"),yt=p("br"),Rt=r(),H=p("h2"),O=p("a"),Bn=p("span"),Ap=c("원본 코드 확인"),At=r(),Pt=p("hr"),Tt=r(),_=p("p"),Pp=c("이전에 확인했던 "),os=p("a"),Tp=c("테스트 페이지"),Wp=c(`의 소스코드는
`),ls=p("a"),Ip=c("여기"),Np=c("에서 확인할 수 있다."),Wt=r(),v=p("p"),hp=c("다소 복잡하긴 하지만, "),jn=p("code"),Kp=c("master.js"),Vp=c("와 "),Mn=p("code"),Bp=c("viewer.js"),jp=c(`가 각각 MASTER, VIEWER단에 해당하는 WebRTC 연결 생성을 담당하고,
`),Dn=p("code"),Mp=c("createSignalingChannel.js"),Dp=c("에서는 채널의 생성을 담당한다."),It=r(),tn=p("p"),xp=c(`Signaling Channel에 대해서는 잘 몰라도 WebRTC에 관련된 경험이나 이해가 어느 정도 있다면 어렵지 않게 이해할 수 있을 것이다. 또한, 설정에 따른 주석이 상세히 달려 있어 이해하기 어렵지 않다.
본인의 경우 프로젝트에 맞게 이 코드를 거의 그대로 활용하여 단방향, Datachannel 생성, Trickle ICE 설정 등을 기본값으로 해주었다.`),Nt=r(),en=p("p"),Hp=c("하지만 이 코드에는 Access Key를 사용자에게 노출시킬 수밖에 없다는 문제점이 있어, 그대로 사용하기는 어려울 것이다."),ht=r(),Kt=p("br"),Vt=p("br"),Bt=r(),q=p("h2"),z=p("a"),xn=p("span"),Op=c("문제점 개선"),jt=r(),Mt=p("hr"),Dt=r(),pn=p("p"),qp=c("앞서 언급한 문제를 해결하기 위해서는 AWS Cognito를 사용하거나 채널의 생성을 백엔드단에서 처리하여 프론트엔드로 생성된 채널 정보를 넘겨주는 방식 등이 있을 것이다."),xt=r(),G=p("p"),zp=c(`Cognito를 사용하는 방법이 더 이상적인 방법이겠지만 아쉽게도 이 프로젝트를 할 당시 Cognito 사용법을 몰랐다 ㅠ
그래서 후자의 방법, 즉 채널의 생성이나 삭제를 백엔드단에서 처리하는 방법으로 해결하였다.
`),cs=p("a"),Gp=c("https://github.com/junhyuk0801/aws-kvs-webtrtc-signaling-channel-example"),Lp=c(`에 수정된 코드가 있다.
변경점을 하나씩 살펴보자.`),Ht=r(),Ot=p("br"),qt=p("br"),zt=r(),L=p("h3"),U=p("a"),Hn=p("span"),Up=c("백엔드"),Gt=r(),on=p("p"),Fp=c(`Backend 폴더에 있다.
express로 구현하였으며, 요청 API는 4개로, 각각 채널 생성, 채널 삭제, MASTER로 채널 정보 받아오기, VIEWER로 채널 정보 받아오기이다.`),Lt=r(),F=p("p"),Xp=c("채널 생성, 삭제 및 채널 정보를 받아오는 로직인 "),On=p("code"),Yp=c("Backend/src/util/kinesis.js"),Jp=c(" 파일의 내용을 중점적으로 살펴보자."),Ut=r(),E=p("p"),Qp=c("javascript aws sdk의 "),qn=p("code"),Zp=c("kinesisvideo"),$p=c(" 및 "),zn=p("code"),gp=c("kinesisvideoskinesisvideosignalingchannels를"),so=c(" 이용하여 채널 생성 및 삭제 로직을 주로 수행하며, 채널의 presign에 "),Gn=p("code"),no=c("SigV4RequestSigner"),ao=c("가 필요하기 때문에, "),Ln=p("code"),to=c("amazon-kinesis-video-streams-webrtc"),eo=c("까지 임포트해준다."),Ft=r(),is=p("pre"),Xt=r(),ln=p("p"),po=c(`이후 채널 생성 등을 담당할 singleton class를 만들어준다.
credential 정보로 aws sdk의 kinesisvideo 인스턴스를 만드는 부분을 생성자에 포함시켰다.`),Yt=r(),rs=p("pre"),Jt=r(),Qt=p("br"),Zt=r(),cn=p("p"),oo=c("채널 생성 로직을 살펴보자."),$t=r(),us=p("pre"),gt=r(),rn=p("p"),lo=c("채널을 생성하기에 앞서 동일한 이름의 채널이 존재하는지 여부를 확인한다. 존재하지 않는다면 채널을 생성하고 생성된 채널의 정보를 가져온다."),se=r(),ks=p("pre"),ne=r(),un=p("p"),co=c(`이후 각 프로토콜(Websocket, HTTPS)별 KVS signaling channel 엔드포인트의 목록을 가져온다.
그리고 앞서 얻은 HTTPS 엔드포인트에서 ICE서버의 목록을 가져온다.`),ae=r(),fs=p("pre"),te=r(),X=p("p"),io=c("이후 "),Un=p("code"),ro=c("SigV4RequestSigner"),uo=c(`를 통해 Websocket 엔드포인트를 presign한 뒤, 앞서 얻은 ICE 서버와 함께 반환한다.
반환된 정보는 프론트엔드에 전달되어 시그널링 채널 및 WebRTC 연결을 생성할 때 사용된다.`),ee=r(),pe=p("br"),oe=r(),kn=p("p"),ko=c("채널 정보를 얻어오는 로직은 채널 생성과 거의 똑같다. 채널을 생성하는 부분이 생략된 형태라고 보면 될 듯 하다."),le=r(),Es=p("pre"),ce=r(),fn=p("p"),fo=c("채널에서 엔드포인트, ice서버 등을 얻어오는 내용은 채널 생성 메소드와 거의 중복되므로, 좀 더 잘게 나누는게 좋겠다."),ie=r(),re=p("br"),ue=r(),En=p("p"),Eo=c("채널 삭제 로직은 비교적 간단하다. ARN을 받아온 뒤 aws sdk client로 삭제 요청만 날려주면 끝."),ke=r(),ms=p("pre"),fe=r(),Ee=p("br"),me=p("br"),ve=r(),Y=p("h3"),J=p("a"),Fn=p("span"),mo=c("프론트엔드"),Ce=r(),m=p("p"),vo=c(`Frontend 폴더에 있다.
채널의 생성 및 정보 조회 부분이 백엔드로 옮겨간 만큼, 해당 API에 요청을 하기 위한 코드가 별도로 존재한다.각각 `),Xn=p("code"),Co=c("Frontend/src/lib/kinesis"),So=c(" 폴더의 "),Yn=p("code"),_o=c("createChannel.js"),wo=c(", "),Jn=p("code"),bo=c("deleteChannel.js"),yo=c(", "),Qn=p("code"),Ro=c("getChannelInfo.js"),Ao=c("를 확인하면 된다."),Se=r(),C=p("p"),Po=c("아래 코드는 "),Zn=p("code"),To=c("createChannel.js"),Wo=c("의 코드이며, "),$n=p("code"),Io=c("deleteChannel.js"),No=c(", "),gn=p("code"),ho=c("getChannelInfo.js"),Ko=c("도 내용이 크게 다르지는 않다. 대충 method나 path만 다른 정도?"),de=r(),vs=p("pre"),_e=r(),y=p("p"),sa=p("code"),Vo=c("master.js"),Bo=c(" 및 "),na=p("code"),jo=c("viewer.js"),Mo=c("에서도 KVS에 직접 조회하는 코드를 날리고 요청으로 받아온 채널 정보를 통해 WebRTC 연결을 생성하도록 변경해주었다."),we=r(),f=p("p"),aa=p("code"),Do=c("SignalingClient"),xo=c("를 생성할 때 "),ta=p("code"),Ho=c("RequestSigner"),Oo=c("라는 인터페이스 필드가 존재하며, "),ea=p("code"),qo=c("RequestSigner"),zo=c("는 "),pa=p("code"),Go=c("getSignedURL()"),Lo=c(" 메소드가 있어야 한다. 이 인터페이스를 충족하게끔 클래스 "),oa=p("code"),Uo=c("CustomSigner"),Fo=c("를 만들어주었다."),be=r(),Cs=p("pre"),ye=r(),Q=p("p"),Xo=c("이후 "),la=p("code"),Yo=c("CustomSigner"),Jo=c("를 생성할 때 서버로부터 받은 키네시스 채널 정보의 signed url와 함께 초기화해주면 된다."),Re=r(),Ss=p("pre"),Ae=r(),mn=p("p"),Qo=c("그 외의 부분은 기본 예제와 거의 동일하다!"),Pe=r(),vn=p("p"),Zo=c(`현재 프로젝트 스펙에 맞게 단방향 연결을 생성하게끔 설정되어 있는데,
가령 이를 양방향으로 수정하더라도 백엔드 코드를 수정할 필요 없이 프론트엔드쪽 코드만 고치면 된다.`),Te=r(),We=p("br"),Ie=p("br"),Ne=r(),Z=p("h2"),$=p("a"),ca=p("span"),$o=c("References"),he=r(),Ke=p("hr"),Ve=r(),R=p("p"),go=c("AWS KVS"),sl=p("br"),nl=r(),ds=p("a"),al=c("https://docs.aws.amazon.com/kinesisvideostreams-webrtc-dg/latest/devguide/what-is-kvswebrtc.html"),Be=r(),A=p("p"),tl=c("Signaling Channel 그림"),el=p("br"),pl=r(),_s=p("a"),ol=c("https://tech.cloud.nongshim.co.kr/2021/04/02/%EB%A7%A4%EB%89%B4%EC%96%BC-kinesis-video-streams-whith-webrtc-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0/"),this.h()},l(s){ws=o(s,"BR",{}),ka=o(s,"BR",{}),fa=u(s),P=o(s,"H2",{id:!0});var a=l(P);T=o(a,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Pl=l(T);dn=o(Pl,"SPAN",{class:!0}),l(dn).forEach(n),Pl.forEach(n),ze=i(a,"Introduction"),a.forEach(n),Ea=u(s),ma=o(s,"HR",{}),va=u(s),bs=o(s,"P",{});var Tl=l(bs);Ge=i(Tl,`학교 캡스톤디자인 프로젝트를 진행중인데,
WebRTC 연결 설정 및 단방향 WebRTC 비디오 영상 전달을 위해 AWS Kinesis Video Stream를 사용하게 되었다.
AWS Kinesis Video Stream에 대해 이것저것 조사해보면서 알게 된 것들과, 단방향 WebRTC 비디오 영상 전달 예제를 만들기까지의 과정을 기록해보았다.`),Tl.forEach(n),Ca=u(s),Sa=o(s,"BR",{}),da=o(s,"BR",{}),_a=u(s),W=o(s,"H2",{id:!0});var ll=l(W);I=o(ll,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Wl=l(I);_n=o(Wl,"SPAN",{class:!0}),l(_n).forEach(n),Wl.forEach(n),Le=i(ll,"AWS Kinesis Video Stream"),ll.forEach(n),wa=u(s),ba=o(s,"HR",{}),ya=u(s),ys=o(s,"P",{});var Il=l(ys);Ue=i(Il,`AWS Kinesis Video Streams는 Fully-Managed AWS 서비스이다.
해당 서비스를 통해 실시간 비디오를 디바이스로부터 AWS 클라우드로 스트리밍하는 데 사용하거나,
실시간 영상 처리나 일괄적인 영상 분석을 하는 어플리케이션을 구축할 수 있다.`),Il.forEach(n),Ra=u(s),Rs=o(s,"P",{});var Nl=l(Rs);Fe=i(Nl,`먼저, 실시간 또는 녹화된 비디오 스트림은 모바일이나 브라우저 환경에서도 재생할 수 있다.
그리고 WebRTC를 통한 P2P 및 양방향 통신을 지원하기 때문에,
WebRTC로 전송된 Amazon Kinesis Video Streams의 실시간 비디오 스트림을 브라우저 환경에서 재생할 수 있게 된다.
이때 특별한 설정 없이도 WebRTC의 STUN, TURN, ICE 서버의 복잡한 기능 설정을 자동으로 해주기 때문에 유용하다.
특히 P2P를 지원하지 않아 TURN 서버로 데이터를 릴레이 해야하는 경우에도, AWS의 infrastructure를 사용하기 떄문에 백엔드 로드를 줄일 수 있다.`),Nl.forEach(n),Aa=u(s),As=o(s,"P",{});var hl=l(As);Xe=i(hl,`Fully-Managed이기 때문에 Amazon Kinesis Video Streams의 underlying infrastructure에 대하여 고민할 필요가 없어진다.
Amazon Kinesis Video Streams는 스트리밍되는 비디오 데이터가 클수록 매체로부터 스트리밍 데이터를 수집하는데 필요한 underlying infrastructure를 자동으로 provisioning하여 scale up해준다.`),hl.forEach(n),Pa=u(s),Ta=o(s,"BR",{}),Wa=u(s),Ps=o(s,"P",{});var Kl=l(Ps);Ye=i(Kl,"AWS Kinesis Video Streams가 제공하는 서비스는 두 종류로 구분할 수 있다."),Kl.forEach(n),Ia=u(s),Ts=o(s,"CENTER",{});var Vl=l(Ts);wn=o(Vl,"P",{});var Bl=l(wn);Ws=o(Bl,"IMG",{src:!0,alt:!0}),Bl.forEach(n),Vl.forEach(n),Na=u(s),Is=o(s,"P",{});var jl=l(Is);Je=i(jl,`하나는 real-time 및 batch processing을 위해 Video Streams을 지원하는 서비스이다.
Media source에서 수집한 영상을 sdk를 통해 kinesis video streams로 전송함으로써
비디오 스트림 데이터들이 수집되고, 지속적으로 저장, 암호화, 인덱싱되어 real-time 및 batch processing을 할 수 있다.
이후 단순 비디오 재생 뿐 아니라 video processing, machine learning을 위해 사용할 수 있다.`),jl.forEach(n),ha=u(s),Ns=o(s,"P",{});var Ml=l(Ns);Qe=i(Ml,`또 하나는 WebRTC signaling channels을 제공하는 서비스이다.
장치나 웹 플랫폼의 소스로부터 캡쳐된 비디오 스트림 데이터는 WebRTC를 통해 전달되며, Real-time 및 양방향 통신을 지원한다.
따라서 낮은 latency에서 P2P streaming을 할 수 있게 된다.`),Ml.forEach(n),Ka=u(s),Va=o(s,"BR",{}),Ba=o(s,"BR",{}),ja=u(s),N=o(s,"H3",{id:!0});var cl=l(N);h=o(cl,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Dl=l(h);bn=o(Dl,"SPAN",{class:!0}),l(bn).forEach(n),Dl.forEach(n),Ze=i(cl,"Kinesis video stream"),cl.forEach(n),Ma=u(s),hs=o(s,"P",{});var xl=l(hs);$e=i(xl,"Kinesis video stream의 구조는 다음과 같다."),xl.forEach(n),Da=u(s),Ks=o(s,"CENTER",{});var Hl=l(Ks);yn=o(Hl,"P",{});var Ol=l(yn);Vs=o(Ol,"IMG",{src:!0,alt:!0}),Ol.forEach(n),Hl.forEach(n),xa=u(s),Bs=o(s,"P",{});var ql=l(Bs);ge=i(ql,"Producer는 Kinesis video stream에 비디오 스트림을 넣는 주체로써, 주로 AWS SDK를 통해 데이터를 집어넣는다."),ql.forEach(n),Ha=u(s),js=o(s,"P",{});var zl=l(js);sp=i(zl,`Consumer는 Kinesis video stream에서 읽어온 데이터를 통해 분석하거나 비디오 스트림을 재생하는 역할을 한다.
이 단계에서 real-time 또는 batch processing이 일어날 수 있을 것이다.`),zl.forEach(n),Oa=u(s),Ms=o(s,"P",{});var Gl=l(Ms);np=i(Gl,`Kinesis video stream는 비디오 스트림을 전송하고, 저장하고, processing을 할 수 있게끔 하는 리소스이다.
하나의 producer만 값을 집어넣고, 한 개 이상의 Consumer가 값을 읽어들이는 것이 일반적인 구조이다.`),Gl.forEach(n),qa=u(s),za=o(s,"BR",{}),Ga=o(s,"BR",{}),La=u(s),K=o(s,"H3",{id:!0});var il=l(K);V=o(il,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Ll=l(V);Rn=o(Ll,"SPAN",{class:!0}),l(Rn).forEach(n),Ll.forEach(n),ap=i(il,"WebRTC signaling channels"),il.forEach(n),Ua=u(s),Ds=o(s,"P",{});var Ul=l(Ds);tp=i(Ul,"WebRTC signaling channels의 구조는 다음과 같다."),Ul.forEach(n),Fa=u(s),xs=o(s,"CENTER",{});var Fl=l(xs);as=o(Fl,"P",{});var je=l(as);Hs=o(je,"IMG",{src:!0,alt:!0}),ep=u(je),ts=o(je,"EM",{});var Me=l(ts);pp=i(Me,"출처 : "),es=o(Me,"A",{href:!0,rel:!0});var Xl=l(es);op=i(Xl,"https://tech.cloud.nongshim.co.kr/2021/04/02/매뉴얼-kinesis-video-streams-whith-webrtc-생성하기"),Xl.forEach(n),lp=i(Me,"/"),Me.forEach(n),je.forEach(n),Fl.forEach(n),Xa=u(s),Os=o(s,"P",{});var Yl=l(Os);cp=i(Yl,`Master client가 WebRTC signaling channel을 생성하면,
Master client와 Viewer client는 생성된 WebRTC signaling channel을 통해 서로 데이터를 주고받는다.
각 채널당 하나의 Master, 하나 이상의 Viewer가 존재하는 것이 일반적이다.`),Yl.forEach(n),Ya=u(s),Ja=o(s,"BR",{}),Qa=o(s,"BR",{}),Za=u(s),B=o(s,"H3",{id:!0});var rl=l(B);j=o(rl,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Jl=l(j);An=o(Jl,"SPAN",{class:!0}),l(An).forEach(n),Jl.forEach(n),ip=i(rl,"System Requirement"),rl.forEach(n),$a=u(s),qs=o(s,"CENTER",{});var Ql=l(qs);Pn=o(Ql,"P",{});var Zl=l(Pn);zs=o(Zl,"IMG",{src:!0,alt:!0}),Zl.forEach(n),Ql.forEach(n),ga=u(s),Gs=o(s,"P",{});var $l=l(Gs);rp=i($l,`Docker 컨테이너나 Raspberry Pi와 같이 제한된 컴퓨팅 능력을 가진 환경에서도
Amazon Kinesis Video Streams을 통해 문제없이 Real-Time Streaming을 수행할 수 있다고 한다.
Amazon Kinesis Video Streams을 사용하면 낮은 시스템 요구사항에서도 서비스를 제공하는 데에는 지장이 없을 것이다.`),$l.forEach(n),st=u(s),nt=o(s,"BR",{}),at=o(s,"BR",{}),tt=u(s),M=o(s,"H2",{id:!0});var ul=l(M);D=o(ul,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var gl=l(D);Tn=o(gl,"SPAN",{class:!0}),l(Tn).forEach(n),gl.forEach(n),up=i(ul,"Getting Started"),ul.forEach(n),et=u(s),pt=o(s,"HR",{}),ot=u(s),Ls=o(s,"P",{});var sc=l(Ls);kp=i(sc,"우리는 위 두 종류의 서비스 중, KVS WebRTC Signaling Channel을 테스트해볼 것이다."),sc.forEach(n),lt=u(s),Us=o(s,"P",{});var nc=l(Us);fp=i(nc,"일단 IAM에서 KVS 관련된 권한 설정을 해준다. 본인은 managed policy로 전체 권한을 허용해주었다."),nc.forEach(n),ct=u(s),Fs=o(s,"CENTER",{});var ac=l(Fs);Wn=o(ac,"P",{});var tc=l(Wn);Xs=o(tc,"IMG",{src:!0,alt:!0}),tc.forEach(n),ac.forEach(n),it=u(s),rt=o(s,"BR",{}),ut=u(s),x=o(s,"P",{});var De=l(x);Ep=i(De,"이제, "),ps=o(De,"A",{href:!0,rel:!0});var ec=l(ps);mp=i(ec,"테스트 페이지"),ec.forEach(n),vp=i(De,"에서 채널을 생성해보자. 테스트 페이지에 들어가보면 대충 이렇게 생겼다."),De.forEach(n),kt=u(s),Ys=o(s,"CENTER",{});var pc=l(Ys);In=o(pc,"P",{});var oc=l(In);Js=o(oc,"IMG",{src:!0,alt:!0}),oc.forEach(n),pc.forEach(n),ft=u(s),d=o(s,"P",{});var Cn=l(d);Cp=i(Cn,"여기서 Region id 및 AWS Credentials을 적당히 작성해주고, 원하는 Channel Name을 부여한 뒤 "),Nn=o(Cn,"EM",{});var lc=l(Nn);Sp=i(lc,"Create Channel"),lc.forEach(n),dp=i(Cn,` 버튼으로 채널을 생성해보자.
성공적으로 채널이 생성되었다면, 하단 로그에 `),hn=o(Cn,"CODE",{});var cc=l(hn);_p=i(cc,"Channel ARN"),cc.forEach(n),wp=i(Cn,`이 출력되었을 것이다.
그리고 AWS Kinesis Video Streams 대시보드의 Signaling channels 탭에 들어가보면, 채널이 생성된 것을 확인할 수 있다.`),Cn.forEach(n),Et=u(s),Qs=o(s,"CENTER",{});var ic=l(Qs);Kn=o(ic,"P",{});var rc=l(Kn);Zs=o(rc,"IMG",{src:!0,alt:!0}),rc.forEach(n),ic.forEach(n),mt=u(s),vt=o(s,"BR",{}),Ct=u(s),$s=o(s,"P",{});var uc=l($s);bp=i(uc,`이제 생성된 채널에서 통신을 해보자.
브라우저 창을 두 개 키고(같은 컴퓨터에 두 개를 켜도 되지만, 서로 다른 컴퓨터에서 하나씩 키는 게 테스트 환경으로서는 더 적합할 것이다),
설정을 따로 안 건드린 상태에서 각각 하나는 MASTER로, 하나는 VIEWER로 켜볼 것이다.`),uc.forEach(n),St=u(s),gs=o(s,"P",{});var kc=l(gs);yp=i(kc,`한 쪽 브라우저에서 먼저 Start Master로 채널을 연 뒤 다른 쪽 브라우저에서 Start Viewer로 채널에 접속하면 된다.
아래 사진은 Master 쪽에서 찍은 사진이다.`),kc.forEach(n),dt=u(s),sn=o(s,"CENTER",{});var fc=l(sn);Vn=o(fc,"P",{});var Ec=l(Vn);nn=o(Ec,"IMG",{src:!0,alt:!0}),Ec.forEach(n),fc.forEach(n),_t=u(s),an=o(s,"P",{});var mc=l(an);Rp=i(mc,`이후 설정에 따라 비디오 전송 여부, 오디오 전송 여부, Datachannel 생성 여부 등을 결정할 수 있으며,
STUN, TURN 등 사용 여부, Trickle ICE 사용 어부 등을 결정할 수 있다.`),mc.forEach(n),wt=u(s),bt=o(s,"BR",{}),yt=o(s,"BR",{}),Rt=u(s),H=o(s,"H2",{id:!0});var kl=l(H);O=o(kl,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var vc=l(O);Bn=o(vc,"SPAN",{class:!0}),l(Bn).forEach(n),vc.forEach(n),Ap=i(kl,"원본 코드 확인"),kl.forEach(n),At=u(s),Pt=o(s,"HR",{}),Tt=u(s),_=o(s,"P",{});var Sn=l(_);Pp=i(Sn,"이전에 확인했던 "),os=o(Sn,"A",{href:!0,rel:!0});var Cc=l(os);Tp=i(Cc,"테스트 페이지"),Cc.forEach(n),Wp=i(Sn,`의 소스코드는
`),ls=o(Sn,"A",{href:!0,rel:!0});var Sc=l(ls);Ip=i(Sc,"여기"),Sc.forEach(n),Np=i(Sn,"에서 확인할 수 있다."),Sn.forEach(n),Wt=u(s),v=o(s,"P",{});var g=l(v);hp=i(g,"다소 복잡하긴 하지만, "),jn=o(g,"CODE",{});var dc=l(jn);Kp=i(dc,"master.js"),dc.forEach(n),Vp=i(g,"와 "),Mn=o(g,"CODE",{});var _c=l(Mn);Bp=i(_c,"viewer.js"),_c.forEach(n),jp=i(g,`가 각각 MASTER, VIEWER단에 해당하는 WebRTC 연결 생성을 담당하고,
`),Dn=o(g,"CODE",{});var wc=l(Dn);Mp=i(wc,"createSignalingChannel.js"),wc.forEach(n),Dp=i(g,"에서는 채널의 생성을 담당한다."),g.forEach(n),It=u(s),tn=o(s,"P",{});var bc=l(tn);xp=i(bc,`Signaling Channel에 대해서는 잘 몰라도 WebRTC에 관련된 경험이나 이해가 어느 정도 있다면 어렵지 않게 이해할 수 있을 것이다. 또한, 설정에 따른 주석이 상세히 달려 있어 이해하기 어렵지 않다.
본인의 경우 프로젝트에 맞게 이 코드를 거의 그대로 활용하여 단방향, Datachannel 생성, Trickle ICE 설정 등을 기본값으로 해주었다.`),bc.forEach(n),Nt=u(s),en=o(s,"P",{});var yc=l(en);Hp=i(yc,"하지만 이 코드에는 Access Key를 사용자에게 노출시킬 수밖에 없다는 문제점이 있어, 그대로 사용하기는 어려울 것이다."),yc.forEach(n),ht=u(s),Kt=o(s,"BR",{}),Vt=o(s,"BR",{}),Bt=u(s),q=o(s,"H2",{id:!0});var fl=l(q);z=o(fl,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Rc=l(z);xn=o(Rc,"SPAN",{class:!0}),l(xn).forEach(n),Rc.forEach(n),Op=i(fl,"문제점 개선"),fl.forEach(n),jt=u(s),Mt=o(s,"HR",{}),Dt=u(s),pn=o(s,"P",{});var Ac=l(pn);qp=i(Ac,"앞서 언급한 문제를 해결하기 위해서는 AWS Cognito를 사용하거나 채널의 생성을 백엔드단에서 처리하여 프론트엔드로 생성된 채널 정보를 넘겨주는 방식 등이 있을 것이다."),Ac.forEach(n),xt=u(s),G=o(s,"P",{});var xe=l(G);zp=i(xe,`Cognito를 사용하는 방법이 더 이상적인 방법이겠지만 아쉽게도 이 프로젝트를 할 당시 Cognito 사용법을 몰랐다 ㅠ
그래서 후자의 방법, 즉 채널의 생성이나 삭제를 백엔드단에서 처리하는 방법으로 해결하였다.
`),cs=o(xe,"A",{href:!0,rel:!0});var Pc=l(cs);Gp=i(Pc,"https://github.com/junhyuk0801/aws-kvs-webtrtc-signaling-channel-example"),Pc.forEach(n),Lp=i(xe,`에 수정된 코드가 있다.
변경점을 하나씩 살펴보자.`),xe.forEach(n),Ht=u(s),Ot=o(s,"BR",{}),qt=o(s,"BR",{}),zt=u(s),L=o(s,"H3",{id:!0});var El=l(L);U=o(El,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Tc=l(U);Hn=o(Tc,"SPAN",{class:!0}),l(Hn).forEach(n),Tc.forEach(n),Up=i(El,"백엔드"),El.forEach(n),Gt=u(s),on=o(s,"P",{});var Wc=l(on);Fp=i(Wc,`Backend 폴더에 있다.
express로 구현하였으며, 요청 API는 4개로, 각각 채널 생성, 채널 삭제, MASTER로 채널 정보 받아오기, VIEWER로 채널 정보 받아오기이다.`),Wc.forEach(n),Lt=u(s),F=o(s,"P",{});var He=l(F);Xp=i(He,"채널 생성, 삭제 및 채널 정보를 받아오는 로직인 "),On=o(He,"CODE",{});var Ic=l(On);Yp=i(Ic,"Backend/src/util/kinesis.js"),Ic.forEach(n),Jp=i(He," 파일의 내용을 중점적으로 살펴보자."),He.forEach(n),Ut=u(s),E=o(s,"P",{});var w=l(E);Qp=i(w,"javascript aws sdk의 "),qn=o(w,"CODE",{});var Nc=l(qn);Zp=i(Nc,"kinesisvideo"),Nc.forEach(n),$p=i(w," 및 "),zn=o(w,"CODE",{});var hc=l(zn);gp=i(hc,"kinesisvideoskinesisvideosignalingchannels를"),hc.forEach(n),so=i(w," 이용하여 채널 생성 및 삭제 로직을 주로 수행하며, 채널의 presign에 "),Gn=o(w,"CODE",{});var Kc=l(Gn);no=i(Kc,"SigV4RequestSigner"),Kc.forEach(n),ao=i(w,"가 필요하기 때문에, "),Ln=o(w,"CODE",{});var Vc=l(Ln);to=i(Vc,"amazon-kinesis-video-streams-webrtc"),Vc.forEach(n),eo=i(w,"까지 임포트해준다."),w.forEach(n),Ft=u(s),is=o(s,"PRE",{class:!0});var _i=l(is);_i.forEach(n),Xt=u(s),ln=o(s,"P",{});var Bc=l(ln);po=i(Bc,`이후 채널 생성 등을 담당할 singleton class를 만들어준다.
credential 정보로 aws sdk의 kinesisvideo 인스턴스를 만드는 부분을 생성자에 포함시켰다.`),Bc.forEach(n),Yt=u(s),rs=o(s,"PRE",{class:!0});var wi=l(rs);wi.forEach(n),Jt=u(s),Qt=o(s,"BR",{}),Zt=u(s),cn=o(s,"P",{});var jc=l(cn);oo=i(jc,"채널 생성 로직을 살펴보자."),jc.forEach(n),$t=u(s),us=o(s,"PRE",{class:!0});var bi=l(us);bi.forEach(n),gt=u(s),rn=o(s,"P",{});var Mc=l(rn);lo=i(Mc,"채널을 생성하기에 앞서 동일한 이름의 채널이 존재하는지 여부를 확인한다. 존재하지 않는다면 채널을 생성하고 생성된 채널의 정보를 가져온다."),Mc.forEach(n),se=u(s),ks=o(s,"PRE",{class:!0});var yi=l(ks);yi.forEach(n),ne=u(s),un=o(s,"P",{});var Dc=l(un);co=i(Dc,`이후 각 프로토콜(Websocket, HTTPS)별 KVS signaling channel 엔드포인트의 목록을 가져온다.
그리고 앞서 얻은 HTTPS 엔드포인트에서 ICE서버의 목록을 가져온다.`),Dc.forEach(n),ae=u(s),fs=o(s,"PRE",{class:!0});var Ri=l(fs);Ri.forEach(n),te=u(s),X=o(s,"P",{});var Oe=l(X);io=i(Oe,"이후 "),Un=o(Oe,"CODE",{});var xc=l(Un);ro=i(xc,"SigV4RequestSigner"),xc.forEach(n),uo=i(Oe,`를 통해 Websocket 엔드포인트를 presign한 뒤, 앞서 얻은 ICE 서버와 함께 반환한다.
반환된 정보는 프론트엔드에 전달되어 시그널링 채널 및 WebRTC 연결을 생성할 때 사용된다.`),Oe.forEach(n),ee=u(s),pe=o(s,"BR",{}),oe=u(s),kn=o(s,"P",{});var Hc=l(kn);ko=i(Hc,"채널 정보를 얻어오는 로직은 채널 생성과 거의 똑같다. 채널을 생성하는 부분이 생략된 형태라고 보면 될 듯 하다."),Hc.forEach(n),le=u(s),Es=o(s,"PRE",{class:!0});var Ai=l(Es);Ai.forEach(n),ce=u(s),fn=o(s,"P",{});var Oc=l(fn);fo=i(Oc,"채널에서 엔드포인트, ice서버 등을 얻어오는 내용은 채널 생성 메소드와 거의 중복되므로, 좀 더 잘게 나누는게 좋겠다."),Oc.forEach(n),ie=u(s),re=o(s,"BR",{}),ue=u(s),En=o(s,"P",{});var qc=l(En);Eo=i(qc,"채널 삭제 로직은 비교적 간단하다. ARN을 받아온 뒤 aws sdk client로 삭제 요청만 날려주면 끝."),qc.forEach(n),ke=u(s),ms=o(s,"PRE",{class:!0});var Pi=l(ms);Pi.forEach(n),fe=u(s),Ee=o(s,"BR",{}),me=o(s,"BR",{}),ve=u(s),Y=o(s,"H3",{id:!0});var ml=l(Y);J=o(ml,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var zc=l(J);Fn=o(zc,"SPAN",{class:!0}),l(Fn).forEach(n),zc.forEach(n),mo=i(ml,"프론트엔드"),ml.forEach(n),Ce=u(s),m=o(s,"P",{});var b=l(m);vo=i(b,`Frontend 폴더에 있다.
채널의 생성 및 정보 조회 부분이 백엔드로 옮겨간 만큼, 해당 API에 요청을 하기 위한 코드가 별도로 존재한다.각각 `),Xn=o(b,"CODE",{});var Gc=l(Xn);Co=i(Gc,"Frontend/src/lib/kinesis"),Gc.forEach(n),So=i(b," 폴더의 "),Yn=o(b,"CODE",{});var Lc=l(Yn);_o=i(Lc,"createChannel.js"),Lc.forEach(n),wo=i(b,", "),Jn=o(b,"CODE",{});var Uc=l(Jn);bo=i(Uc,"deleteChannel.js"),Uc.forEach(n),yo=i(b,", "),Qn=o(b,"CODE",{});var Fc=l(Qn);Ro=i(Fc,"getChannelInfo.js"),Fc.forEach(n),Ao=i(b,"를 확인하면 된다."),b.forEach(n),Se=u(s),C=o(s,"P",{});var ss=l(C);Po=i(ss,"아래 코드는 "),Zn=o(ss,"CODE",{});var Xc=l(Zn);To=i(Xc,"createChannel.js"),Xc.forEach(n),Wo=i(ss,"의 코드이며, "),$n=o(ss,"CODE",{});var Yc=l($n);Io=i(Yc,"deleteChannel.js"),Yc.forEach(n),No=i(ss,", "),gn=o(ss,"CODE",{});var Jc=l(gn);ho=i(Jc,"getChannelInfo.js"),Jc.forEach(n),Ko=i(ss,"도 내용이 크게 다르지는 않다. 대충 method나 path만 다른 정도?"),ss.forEach(n),de=u(s),vs=o(s,"PRE",{class:!0});var Ti=l(vs);Ti.forEach(n),_e=u(s),y=o(s,"P",{});var ia=l(y);sa=o(ia,"CODE",{});var Qc=l(sa);Vo=i(Qc,"master.js"),Qc.forEach(n),Bo=i(ia," 및 "),na=o(ia,"CODE",{});var Zc=l(na);jo=i(Zc,"viewer.js"),Zc.forEach(n),Mo=i(ia,"에서도 KVS에 직접 조회하는 코드를 날리고 요청으로 받아온 채널 정보를 통해 WebRTC 연결을 생성하도록 변경해주었다."),ia.forEach(n),we=u(s),f=o(s,"P",{});var S=l(f);aa=o(S,"CODE",{});var $c=l(aa);Do=i($c,"SignalingClient"),$c.forEach(n),xo=i(S,"를 생성할 때 "),ta=o(S,"CODE",{});var gc=l(ta);Ho=i(gc,"RequestSigner"),gc.forEach(n),Oo=i(S,"라는 인터페이스 필드가 존재하며, "),ea=o(S,"CODE",{});var si=l(ea);qo=i(si,"RequestSigner"),si.forEach(n),zo=i(S,"는 "),pa=o(S,"CODE",{});var ni=l(pa);Go=i(ni,"getSignedURL()"),ni.forEach(n),Lo=i(S," 메소드가 있어야 한다. 이 인터페이스를 충족하게끔 클래스 "),oa=o(S,"CODE",{});var ai=l(oa);Uo=i(ai,"CustomSigner"),ai.forEach(n),Fo=i(S,"를 만들어주었다."),S.forEach(n),be=u(s),Cs=o(s,"PRE",{class:!0});var Wi=l(Cs);Wi.forEach(n),ye=u(s),Q=o(s,"P",{});var qe=l(Q);Xo=i(qe,"이후 "),la=o(qe,"CODE",{});var ti=l(la);Yo=i(ti,"CustomSigner"),ti.forEach(n),Jo=i(qe,"를 생성할 때 서버로부터 받은 키네시스 채널 정보의 signed url와 함께 초기화해주면 된다."),qe.forEach(n),Re=u(s),Ss=o(s,"PRE",{class:!0});var Ii=l(Ss);Ii.forEach(n),Ae=u(s),mn=o(s,"P",{});var ei=l(mn);Qo=i(ei,"그 외의 부분은 기본 예제와 거의 동일하다!"),ei.forEach(n),Pe=u(s),vn=o(s,"P",{});var pi=l(vn);Zo=i(pi,`현재 프로젝트 스펙에 맞게 단방향 연결을 생성하게끔 설정되어 있는데,
가령 이를 양방향으로 수정하더라도 백엔드 코드를 수정할 필요 없이 프론트엔드쪽 코드만 고치면 된다.`),pi.forEach(n),Te=u(s),We=o(s,"BR",{}),Ie=o(s,"BR",{}),Ne=u(s),Z=o(s,"H2",{id:!0});var vl=l(Z);$=o(vl,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var oi=l($);ca=o(oi,"SPAN",{class:!0}),l(ca).forEach(n),oi.forEach(n),$o=i(vl,"References"),vl.forEach(n),he=u(s),Ke=o(s,"HR",{}),Ve=u(s),R=o(s,"P",{});var ra=l(R);go=i(ra,"AWS KVS"),sl=o(ra,"BR",{}),nl=u(ra),ds=o(ra,"A",{href:!0,rel:!0});var li=l(ds);al=i(li,"https://docs.aws.amazon.com/kinesisvideostreams-webrtc-dg/latest/devguide/what-is-kvswebrtc.html"),li.forEach(n),ra.forEach(n),Be=u(s),A=o(s,"P",{});var ua=l(A);tl=i(ua,"Signaling Channel 그림"),el=o(ua,"BR",{}),pl=u(ua),_s=o(ua,"A",{href:!0,rel:!0});var ci=l(_s);ol=i(ci,"https://tech.cloud.nongshim.co.kr/2021/04/02/%EB%A7%A4%EB%89%B4%EC%96%BC-kinesis-video-streams-whith-webrtc-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0/"),ci.forEach(n),ua.forEach(n),this.h()},h(){k(dn,"class","icon icon-link"),k(T,"aria-hidden","true"),k(T,"tabindex","-1"),k(T,"href","#introduction"),k(P,"id","introduction"),k(_n,"class","icon icon-link"),k(I,"aria-hidden","true"),k(I,"tabindex","-1"),k(I,"href","#aws-kinesis-video-stream"),k(W,"id","aws-kinesis-video-stream"),ns(Ws.src,Sl="/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/1.PNG")||k(Ws,"src",Sl),k(Ws,"alt","사진"),k(bn,"class","icon icon-link"),k(h,"aria-hidden","true"),k(h,"tabindex","-1"),k(h,"href","#kinesis-video-stream"),k(N,"id","kinesis-video-stream"),ns(Vs.src,dl="/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/2.PNG")||k(Vs,"src",dl),k(Vs,"alt","사진"),k(Rn,"class","icon icon-link"),k(V,"aria-hidden","true"),k(V,"tabindex","-1"),k(V,"href","#webrtc-signaling-channels"),k(K,"id","webrtc-signaling-channels"),ns(Hs.src,_l="/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/3.PNG")||k(Hs,"src",_l),k(Hs,"alt","사진"),k(es,"href","https://tech.cloud.nongshim.co.kr/2021/04/02/%EB%A7%A4%EB%89%B4%EC%96%BC-kinesis-video-streams-whith-webrtc-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0"),k(es,"rel","nofollow"),k(An,"class","icon icon-link"),k(j,"aria-hidden","true"),k(j,"tabindex","-1"),k(j,"href","#system-requirement"),k(B,"id","system-requirement"),ns(zs.src,wl="/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/4.PNG")||k(zs,"src",wl),k(zs,"alt","사진"),k(Tn,"class","icon icon-link"),k(D,"aria-hidden","true"),k(D,"tabindex","-1"),k(D,"href","#getting-started"),k(M,"id","getting-started"),ns(Xs.src,bl="/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/5.PNG")||k(Xs,"src",bl),k(Xs,"alt","사진"),k(ps,"href","https://awslabs.github.io/amazon-kinesis-video-streams-webrtc-sdk-js/examples/index.html"),k(ps,"rel","nofollow"),ns(Js.src,yl="/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/6.PNG")||k(Js,"src",yl),k(Js,"alt","사진"),ns(Zs.src,Rl="/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/7.PNG")||k(Zs,"src",Rl),k(Zs,"alt","사진"),ns(nn.src,Al="/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/8.PNG")||k(nn,"src",Al),k(nn,"alt","사진"),k(Bn,"class","icon icon-link"),k(O,"aria-hidden","true"),k(O,"tabindex","-1"),k(O,"href","#원본-코드-확인"),k(H,"id","원본-코드-확인"),k(os,"href","https://awslabs.github.io/amazon-kinesis-video-streams-webrtc-sdk-js/examples/index.html"),k(os,"rel","nofollow"),k(ls,"href","https://github.com/awslabs/amazon-kinesis-video-streams-webrtc-sdk-js/tree/master/examples"),k(ls,"rel","nofollow"),k(xn,"class","icon icon-link"),k(z,"aria-hidden","true"),k(z,"tabindex","-1"),k(z,"href","#문제점-개선"),k(q,"id","문제점-개선"),k(cs,"href","https://github.com/junhyuk0801/aws-kvs-webtrtc-signaling-channel-example"),k(cs,"rel","nofollow"),k(Hn,"class","icon icon-link"),k(U,"aria-hidden","true"),k(U,"tabindex","-1"),k(U,"href","#백엔드"),k(L,"id","백엔드"),k(is,"class","language-javascript"),k(rs,"class","language-javascript"),k(us,"class","language-javascript"),k(ks,"class","language-javascript"),k(fs,"class","language-javascript"),k(Es,"class","language-javascript"),k(ms,"class","language-javascript"),k(Fn,"class","icon icon-link"),k(J,"aria-hidden","true"),k(J,"tabindex","-1"),k(J,"href","#프론트엔드"),k(Y,"id","프론트엔드"),k(vs,"class","language-javascript"),k(Cs,"class","language-javascript"),k(Ss,"class","language-javascript"),k(ca,"class","icon icon-link"),k($,"aria-hidden","true"),k($,"tabindex","-1"),k($,"href","#references"),k(Z,"id","references"),k(ds,"href","https://docs.aws.amazon.com/kinesisvideostreams-webrtc-dg/latest/devguide/what-is-kvswebrtc.html"),k(ds,"rel","nofollow"),k(_s,"href","https://tech.cloud.nongshim.co.kr/2021/04/02/%EB%A7%A4%EB%89%B4%EC%96%BC-kinesis-video-streams-whith-webrtc-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0/"),k(_s,"rel","nofollow")},m(s,a){t(s,ws,a),t(s,ka,a),t(s,fa,a),t(s,P,a),e(P,T),e(T,dn),e(P,ze),t(s,Ea,a),t(s,ma,a),t(s,va,a),t(s,bs,a),e(bs,Ge),t(s,Ca,a),t(s,Sa,a),t(s,da,a),t(s,_a,a),t(s,W,a),e(W,I),e(I,_n),e(W,Le),t(s,wa,a),t(s,ba,a),t(s,ya,a),t(s,ys,a),e(ys,Ue),t(s,Ra,a),t(s,Rs,a),e(Rs,Fe),t(s,Aa,a),t(s,As,a),e(As,Xe),t(s,Pa,a),t(s,Ta,a),t(s,Wa,a),t(s,Ps,a),e(Ps,Ye),t(s,Ia,a),t(s,Ts,a),e(Ts,wn),e(wn,Ws),t(s,Na,a),t(s,Is,a),e(Is,Je),t(s,ha,a),t(s,Ns,a),e(Ns,Qe),t(s,Ka,a),t(s,Va,a),t(s,Ba,a),t(s,ja,a),t(s,N,a),e(N,h),e(h,bn),e(N,Ze),t(s,Ma,a),t(s,hs,a),e(hs,$e),t(s,Da,a),t(s,Ks,a),e(Ks,yn),e(yn,Vs),t(s,xa,a),t(s,Bs,a),e(Bs,ge),t(s,Ha,a),t(s,js,a),e(js,sp),t(s,Oa,a),t(s,Ms,a),e(Ms,np),t(s,qa,a),t(s,za,a),t(s,Ga,a),t(s,La,a),t(s,K,a),e(K,V),e(V,Rn),e(K,ap),t(s,Ua,a),t(s,Ds,a),e(Ds,tp),t(s,Fa,a),t(s,xs,a),e(xs,as),e(as,Hs),e(as,ep),e(as,ts),e(ts,pp),e(ts,es),e(es,op),e(ts,lp),t(s,Xa,a),t(s,Os,a),e(Os,cp),t(s,Ya,a),t(s,Ja,a),t(s,Qa,a),t(s,Za,a),t(s,B,a),e(B,j),e(j,An),e(B,ip),t(s,$a,a),t(s,qs,a),e(qs,Pn),e(Pn,zs),t(s,ga,a),t(s,Gs,a),e(Gs,rp),t(s,st,a),t(s,nt,a),t(s,at,a),t(s,tt,a),t(s,M,a),e(M,D),e(D,Tn),e(M,up),t(s,et,a),t(s,pt,a),t(s,ot,a),t(s,Ls,a),e(Ls,kp),t(s,lt,a),t(s,Us,a),e(Us,fp),t(s,ct,a),t(s,Fs,a),e(Fs,Wn),e(Wn,Xs),t(s,it,a),t(s,rt,a),t(s,ut,a),t(s,x,a),e(x,Ep),e(x,ps),e(ps,mp),e(x,vp),t(s,kt,a),t(s,Ys,a),e(Ys,In),e(In,Js),t(s,ft,a),t(s,d,a),e(d,Cp),e(d,Nn),e(Nn,Sp),e(d,dp),e(d,hn),e(hn,_p),e(d,wp),t(s,Et,a),t(s,Qs,a),e(Qs,Kn),e(Kn,Zs),t(s,mt,a),t(s,vt,a),t(s,Ct,a),t(s,$s,a),e($s,bp),t(s,St,a),t(s,gs,a),e(gs,yp),t(s,dt,a),t(s,sn,a),e(sn,Vn),e(Vn,nn),t(s,_t,a),t(s,an,a),e(an,Rp),t(s,wt,a),t(s,bt,a),t(s,yt,a),t(s,Rt,a),t(s,H,a),e(H,O),e(O,Bn),e(H,Ap),t(s,At,a),t(s,Pt,a),t(s,Tt,a),t(s,_,a),e(_,Pp),e(_,os),e(os,Tp),e(_,Wp),e(_,ls),e(ls,Ip),e(_,Np),t(s,Wt,a),t(s,v,a),e(v,hp),e(v,jn),e(jn,Kp),e(v,Vp),e(v,Mn),e(Mn,Bp),e(v,jp),e(v,Dn),e(Dn,Mp),e(v,Dp),t(s,It,a),t(s,tn,a),e(tn,xp),t(s,Nt,a),t(s,en,a),e(en,Hp),t(s,ht,a),t(s,Kt,a),t(s,Vt,a),t(s,Bt,a),t(s,q,a),e(q,z),e(z,xn),e(q,Op),t(s,jt,a),t(s,Mt,a),t(s,Dt,a),t(s,pn,a),e(pn,qp),t(s,xt,a),t(s,G,a),e(G,zp),e(G,cs),e(cs,Gp),e(G,Lp),t(s,Ht,a),t(s,Ot,a),t(s,qt,a),t(s,zt,a),t(s,L,a),e(L,U),e(U,Hn),e(L,Up),t(s,Gt,a),t(s,on,a),e(on,Fp),t(s,Lt,a),t(s,F,a),e(F,Xp),e(F,On),e(On,Yp),e(F,Jp),t(s,Ut,a),t(s,E,a),e(E,Qp),e(E,qn),e(qn,Zp),e(E,$p),e(E,zn),e(zn,gp),e(E,so),e(E,Gn),e(Gn,no),e(E,ao),e(E,Ln),e(Ln,to),e(E,eo),t(s,Ft,a),t(s,is,a),is.innerHTML=ri,t(s,Xt,a),t(s,ln,a),e(ln,po),t(s,Yt,a),t(s,rs,a),rs.innerHTML=ui,t(s,Jt,a),t(s,Qt,a),t(s,Zt,a),t(s,cn,a),e(cn,oo),t(s,$t,a),t(s,us,a),us.innerHTML=ki,t(s,gt,a),t(s,rn,a),e(rn,lo),t(s,se,a),t(s,ks,a),ks.innerHTML=fi,t(s,ne,a),t(s,un,a),e(un,co),t(s,ae,a),t(s,fs,a),fs.innerHTML=Ei,t(s,te,a),t(s,X,a),e(X,io),e(X,Un),e(Un,ro),e(X,uo),t(s,ee,a),t(s,pe,a),t(s,oe,a),t(s,kn,a),e(kn,ko),t(s,le,a),t(s,Es,a),Es.innerHTML=mi,t(s,ce,a),t(s,fn,a),e(fn,fo),t(s,ie,a),t(s,re,a),t(s,ue,a),t(s,En,a),e(En,Eo),t(s,ke,a),t(s,ms,a),ms.innerHTML=vi,t(s,fe,a),t(s,Ee,a),t(s,me,a),t(s,ve,a),t(s,Y,a),e(Y,J),e(J,Fn),e(Y,mo),t(s,Ce,a),t(s,m,a),e(m,vo),e(m,Xn),e(Xn,Co),e(m,So),e(m,Yn),e(Yn,_o),e(m,wo),e(m,Jn),e(Jn,bo),e(m,yo),e(m,Qn),e(Qn,Ro),e(m,Ao),t(s,Se,a),t(s,C,a),e(C,Po),e(C,Zn),e(Zn,To),e(C,Wo),e(C,$n),e($n,Io),e(C,No),e(C,gn),e(gn,ho),e(C,Ko),t(s,de,a),t(s,vs,a),vs.innerHTML=Ci,t(s,_e,a),t(s,y,a),e(y,sa),e(sa,Vo),e(y,Bo),e(y,na),e(na,jo),e(y,Mo),t(s,we,a),t(s,f,a),e(f,aa),e(aa,Do),e(f,xo),e(f,ta),e(ta,Ho),e(f,Oo),e(f,ea),e(ea,qo),e(f,zo),e(f,pa),e(pa,Go),e(f,Lo),e(f,oa),e(oa,Uo),e(f,Fo),t(s,be,a),t(s,Cs,a),Cs.innerHTML=Si,t(s,ye,a),t(s,Q,a),e(Q,Xo),e(Q,la),e(la,Yo),e(Q,Jo),t(s,Re,a),t(s,Ss,a),Ss.innerHTML=di,t(s,Ae,a),t(s,mn,a),e(mn,Qo),t(s,Pe,a),t(s,vn,a),e(vn,Zo),t(s,Te,a),t(s,We,a),t(s,Ie,a),t(s,Ne,a),t(s,Z,a),e(Z,$),e($,ca),e(Z,$o),t(s,he,a),t(s,Ke,a),t(s,Ve,a),t(s,R,a),e(R,go),e(R,sl),e(R,nl),e(R,ds),e(ds,al),t(s,Be,a),t(s,A,a),e(A,tl),e(A,el),e(A,pl),e(A,_s),e(_s,ol)},p:Cl,i:Cl,o:Cl,d(s){s&&n(ws),s&&n(ka),s&&n(fa),s&&n(P),s&&n(Ea),s&&n(ma),s&&n(va),s&&n(bs),s&&n(Ca),s&&n(Sa),s&&n(da),s&&n(_a),s&&n(W),s&&n(wa),s&&n(ba),s&&n(ya),s&&n(ys),s&&n(Ra),s&&n(Rs),s&&n(Aa),s&&n(As),s&&n(Pa),s&&n(Ta),s&&n(Wa),s&&n(Ps),s&&n(Ia),s&&n(Ts),s&&n(Na),s&&n(Is),s&&n(ha),s&&n(Ns),s&&n(Ka),s&&n(Va),s&&n(Ba),s&&n(ja),s&&n(N),s&&n(Ma),s&&n(hs),s&&n(Da),s&&n(Ks),s&&n(xa),s&&n(Bs),s&&n(Ha),s&&n(js),s&&n(Oa),s&&n(Ms),s&&n(qa),s&&n(za),s&&n(Ga),s&&n(La),s&&n(K),s&&n(Ua),s&&n(Ds),s&&n(Fa),s&&n(xs),s&&n(Xa),s&&n(Os),s&&n(Ya),s&&n(Ja),s&&n(Qa),s&&n(Za),s&&n(B),s&&n($a),s&&n(qs),s&&n(ga),s&&n(Gs),s&&n(st),s&&n(nt),s&&n(at),s&&n(tt),s&&n(M),s&&n(et),s&&n(pt),s&&n(ot),s&&n(Ls),s&&n(lt),s&&n(Us),s&&n(ct),s&&n(Fs),s&&n(it),s&&n(rt),s&&n(ut),s&&n(x),s&&n(kt),s&&n(Ys),s&&n(ft),s&&n(d),s&&n(Et),s&&n(Qs),s&&n(mt),s&&n(vt),s&&n(Ct),s&&n($s),s&&n(St),s&&n(gs),s&&n(dt),s&&n(sn),s&&n(_t),s&&n(an),s&&n(wt),s&&n(bt),s&&n(yt),s&&n(Rt),s&&n(H),s&&n(At),s&&n(Pt),s&&n(Tt),s&&n(_),s&&n(Wt),s&&n(v),s&&n(It),s&&n(tn),s&&n(Nt),s&&n(en),s&&n(ht),s&&n(Kt),s&&n(Vt),s&&n(Bt),s&&n(q),s&&n(jt),s&&n(Mt),s&&n(Dt),s&&n(pn),s&&n(xt),s&&n(G),s&&n(Ht),s&&n(Ot),s&&n(qt),s&&n(zt),s&&n(L),s&&n(Gt),s&&n(on),s&&n(Lt),s&&n(F),s&&n(Ut),s&&n(E),s&&n(Ft),s&&n(is),s&&n(Xt),s&&n(ln),s&&n(Yt),s&&n(rs),s&&n(Jt),s&&n(Qt),s&&n(Zt),s&&n(cn),s&&n($t),s&&n(us),s&&n(gt),s&&n(rn),s&&n(se),s&&n(ks),s&&n(ne),s&&n(un),s&&n(ae),s&&n(fs),s&&n(te),s&&n(X),s&&n(ee),s&&n(pe),s&&n(oe),s&&n(kn),s&&n(le),s&&n(Es),s&&n(ce),s&&n(fn),s&&n(ie),s&&n(re),s&&n(ue),s&&n(En),s&&n(ke),s&&n(ms),s&&n(fe),s&&n(Ee),s&&n(me),s&&n(ve),s&&n(Y),s&&n(Ce),s&&n(m),s&&n(Se),s&&n(C),s&&n(de),s&&n(vs),s&&n(_e),s&&n(y),s&&n(we),s&&n(f),s&&n(be),s&&n(Cs),s&&n(ye),s&&n(Q),s&&n(Re),s&&n(Ss),s&&n(Ae),s&&n(mn),s&&n(Pe),s&&n(vn),s&&n(Te),s&&n(We),s&&n(Ie),s&&n(Ne),s&&n(Z),s&&n(he),s&&n(Ke),s&&n(Ve),s&&n(R),s&&n(Be),s&&n(A)}}}const ji={title:"Amazon KVS WebRTC signaling channels 사용기",date:"2023-01-01",excerpt:"Amazon KVS WebRTC signaling channel에 대해 알아보자",categories:["AWS","AWS Kinesis Video Stream","WebRTC"],coverImage:"/post_img/Cloud/AWS/AWS_KVS_webrtc_signaling_channel/cover.png",coverWidth:16,coverHeight:9,indexed:!0,exposed:!0};class Mi extends Ni{constructor(ws){super(),hi(this,ws,null,Vi,Ki,{})}}export{Mi as default,ji as metadata};
