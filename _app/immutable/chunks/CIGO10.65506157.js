import{S as _k,i as vk,s as yk,k as e,q as t,a as k,y as Z,l as c,m as u,r as p,h as s,c as i,z as K,n as d,U as $k,b as l,E as a,A as Q,g as X,d as Y,B as g,M as sn}from"./index.d78780bf.js";import{C as nn}from"./CodeBlockWrapper.9fa2b505.js";function bk(w){let r,E=`<code class="language-go"><span class="token keyword">func</span> <span class="token function">philosopher</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right <span class="token operator">*</span>sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">for</span> <span class="token punctuation">&#123;</span>
		left<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		right<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// eat</span>
		right<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		left<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	forks <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	<span class="token keyword">go</span> <span class="token function">philosopher</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>forks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>forks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">philosopher</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>forks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>forks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-go")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function Ck(w){let r,E=`<code class="language-text">fatal error: all goroutines are asleep - deadlock!

goroutine 1 [select (no cases)]:
main.main()
        /home/junhyuk/Programming/Golang/CIGO/chapter10/tracing-deadlock.go:19 +0xa5

goroutine 5 [sync.Mutex.Lock]:
sync.runtime_SemacquireMutex(0x0?, 0x0?, 0x0?)
        /usr/local/go/src/runtime/sema.go:77 +0x26
sync.(*Mutex).lockSlow(0xc00001a0b8)
        /usr/local/go/src/sync/mutex.go:171 +0x165
sync.(*Mutex).Lock(...)
        /usr/local/go/src/sync/mutex.go:90
main.philosopher(0xc00001a0b0, 0xc00001a0b8)
        /home/junhyuk/Programming/Golang/CIGO/chapter10/tracing-deadlock.go:8 +0x6e
created by main.main
        /home/junhyuk/Programming/Golang/CIGO/chapter10/tracing-deadlock.go:17 +0x65

goroutine 6 [sync.Mutex.Lock]:
sync.runtime_SemacquireMutex(0x0?, 0x0?, 0x0?)
        /usr/local/go/src/runtime/sema.go:77 +0x26
sync.(*Mutex).lockSlow(0xc00001a0b0)
        /usr/local/go/src/sync/mutex.go:171 +0x165
sync.(*Mutex).Lock(...)
        /usr/local/go/src/sync/mutex.go:90
main.philosopher(0xc00001a0b8, 0xc00001a0b0)
        /home/junhyuk/Programming/Golang/CIGO/chapter10/tracing-deadlock.go:8 +0x6e
created by main.main
        /home/junhyuk/Programming/Golang/CIGO/chapter10/tracing-deadlock.go:18 +0x9b
exit status 2</code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-text")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function xk(w){let r,E=`<code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	wg <span class="token operator">:=</span> sync<span class="token punctuation">.</span>WaitGroup<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
	ll <span class="token operator">:=</span> list<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
			ll<span class="token punctuation">.</span><span class="token function">PushBack</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
			ll<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>ll<span class="token punctuation">.</span><span class="token function">Front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-go")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function Dk(w){let r,E=`<code class="language-go"><span class="token keyword">type</span> Monitor<span class="token punctuation">[</span>Req<span class="token punctuation">,</span> Res any<span class="token punctuation">]</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	CallTimeout  time<span class="token punctuation">.</span>Duration
	AlertTimeout time<span class="token punctuation">.</span>Duration
	Alert        <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	SlowFunc     <span class="token keyword">func</span><span class="token punctuation">(</span>Req<span class="token punctuation">)</span> <span class="token punctuation">(</span>Res<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	Done         <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	active       <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	full         <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	heartBeat    <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-go")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function Pk(w){let r,E=`<code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>mon Monitor<span class="token punctuation">[</span>Req<span class="token punctuation">,</span> Res<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">Call</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req Req<span class="token punctuation">)</span> <span class="token punctuation">(</span>Res<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> res Res
	<span class="token keyword">var</span> err <span class="token builtin">error</span>

	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">case</span> mon<span class="token punctuation">.</span>active <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">case</span> mon<span class="token punctuation">.</span>active <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
		<span class="token keyword">case</span> mon<span class="token punctuation">.</span>full <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> res<span class="token punctuation">,</span> ErrBusy
		<span class="token keyword">default</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> res<span class="token punctuation">,</span> ErrBusy
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	complete <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>active
			<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">case</span> mon<span class="token punctuation">.</span>heartBeat <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
			<span class="token keyword">default</span><span class="token punctuation">:</span>
			<span class="token punctuation">&#125;</span>
			<span class="token function">close</span><span class="token punctuation">(</span>complete<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		res<span class="token punctuation">,</span> err <span class="token operator">=</span> mon<span class="token punctuation">.</span><span class="token function">SlowFunc</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>mon<span class="token punctuation">.</span>CallTimeout<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> res<span class="token punctuation">,</span> ErrTimeout
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>complete<span class="token punctuation">:</span>
		<span class="token keyword">return</span> res<span class="token punctuation">,</span> err
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-go")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function Sk(w){let r,E=`<code class="language-go"><span class="token keyword">func</span> NewMonitor<span class="token punctuation">[</span>Req<span class="token punctuation">,</span> Res any<span class="token punctuation">]</span><span class="token punctuation">(</span>callTimeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">,</span> alertTimeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">,</span> maxActive <span class="token builtin">int</span><span class="token punctuation">,</span> slowFunc <span class="token keyword">func</span><span class="token punctuation">(</span>Req<span class="token punctuation">)</span> <span class="token punctuation">(</span>Res<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">)</span> Monitor<span class="token punctuation">[</span>Req<span class="token punctuation">,</span> Res<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
	mon <span class="token operator">:=</span> Monitor<span class="token punctuation">[</span>Req<span class="token punctuation">,</span> Res<span class="token punctuation">]</span><span class="token punctuation">&#123;</span>
		CallTimeout<span class="token punctuation">:</span>  callTimeout<span class="token punctuation">,</span>
		AlertTimeout<span class="token punctuation">:</span> alertTimeout<span class="token punctuation">,</span>
		SlowFunc<span class="token punctuation">:</span>     slowFunc<span class="token punctuation">,</span>
		Alert<span class="token punctuation">:</span>        <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		Done<span class="token punctuation">:</span>         <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		active<span class="token punctuation">:</span>       <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> maxActive<span class="token punctuation">)</span><span class="token punctuation">,</span>
		full<span class="token punctuation">:</span>         <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		heartBeat<span class="token punctuation">:</span>    <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">var</span> timer <span class="token operator">*</span>time<span class="token punctuation">.</span>Timer
		<span class="token keyword">for</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">if</span> timer <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>full<span class="token punctuation">:</span>
					timer <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>mon<span class="token punctuation">.</span>AlertTimeout<span class="token punctuation">)</span>
				<span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>Done<span class="token punctuation">:</span>
					<span class="token keyword">return</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">case</span> <span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C<span class="token punctuation">:</span>
					mon<span class="token punctuation">.</span>Alert <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
				<span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>heartBeat<span class="token punctuation">:</span>
					<span class="token keyword">if</span> <span class="token operator">!</span>timer<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
						<span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C
					<span class="token punctuation">&#125;</span>
				<span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>Done<span class="token punctuation">:</span>
					<span class="token keyword">return</span>
				<span class="token punctuation">&#125;</span>
				timer <span class="token operator">=</span> <span class="token boolean">nil</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> mon
<span class="token punctuation">&#125;</span></code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-go")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function Ok(w){let r,E=`<code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	mon <span class="token operator">:=</span> <span class="token function">NewMonitor</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">,</span> <span class="token number">100</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> SlowFunc<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>Alert<span class="token punctuation">:</span>
			pprof<span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">"goroutine"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WriteTo</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>Done<span class="token punctuation">:</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">for</span> <span class="token punctuation">&#123;</span>
				<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> mon<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Request<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
					fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>mon<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-go")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function Rk(w){let r,E=`<code class="language-go"><span class="token keyword">func</span> <span class="token function">restart</span><span class="token punctuation">(</span>done <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> f <span class="token keyword">func</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> heartBeat <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">for</span> <span class="token punctuation">&#123;</span>
		funcDone <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		heartBeat <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token function">f</span><span class="token punctuation">(</span>funcDone<span class="token punctuation">,</span> heartBeat<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
		retry <span class="token operator">:=</span> <span class="token boolean">false</span>

		<span class="token keyword">for</span> <span class="token operator">!</span>retry <span class="token punctuation">&#123;</span>
			<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">:</span>
				<span class="token function">close</span><span class="token punctuation">(</span>funcDone<span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span>heartBeat<span class="token punctuation">:</span>
				<span class="token keyword">if</span> <span class="token operator">!</span>timer<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					<span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C
				<span class="token punctuation">&#125;</span>
				timer<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C<span class="token punctuation">:</span>
				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"function timed out, restarting"</span><span class="token punctuation">)</span>
				<span class="token function">close</span><span class="token punctuation">(</span>funcDone<span class="token punctuation">)</span>
				retry <span class="token operator">=</span> <span class="token boolean">true</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-go")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function Mk(w){let r,E=`<code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	mon <span class="token operator">:=</span> <span class="token function">NewMonitor</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">,</span> <span class="token number">100</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> SlowFunc<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>Alert<span class="token punctuation">:</span>
			pprof<span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">"goroutine"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WriteTo</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>Done<span class="token punctuation">:</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">for</span> <span class="token punctuation">&#123;</span>
				<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> mon<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Request<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
					fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>mon<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`;return{c(){r=e("pre"),this.h()},l(f){r=c(f,"PRE",{class:!0});var m=u(r);m.forEach(s),this.h()},h(){d(r,"class","language-go")},m(f,m){l(f,r,m),r.innerHTML=E},p:sn,d(f){f&&s(r)}}}function Bk(w){let r,E,f,m,Za,Ka,an,tn,ws,Ip,Qa,Xa,Ya,Hn,Np,ga,pn,nt,qn,Wp,st,on,at,P,jp,_s,Up,Vp,vs,Jp,zp,ys,Zp,Kp,tt,S,Qp,$s,Xp,Yp,bs,gp,no,Cs,so,ao,pt,O,to,xs,po,oo,Ds,eo,co,Ps,lo,uo,ot,L,ko,Ss,io,ro,Os,fo,mo,et,In,Eo,ct,en,lt,Nn,wo,ut,Mn,kk=`<code class="language-text">panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0x45d4a0]

goroutine 6 [running]:
container/list.(*List).Remove(...)
        /usr/local/go/src/container/list/list.go:135
main.main.func2()
        /home/junhyuk/Programming/Golang/CIGO/chapter10/tracing-list.go:23 +0x80
created by main.main
        /home/junhyuk/Programming/Golang/CIGO/chapter10/tracing-list.go:20 +0x125
exit status 2</code>`,kt,b,_o,Rs,vo,yo,Ms,$o,bo,Bs,Co,xo,Ts,Do,Po,it,Wn,So,rt,jn,Oo,ft,dt,mt,Et,cn,ln,Gs,Ro,wt,_t,vt,Un,Mo,yt,A,Bo,Fs,To,Go,Ls,Fo,Lo,$t,Vn,Ao,bt,Jn,ho,Ct,xt,Dt,un,kn,As,Ho,Pt,h,qo,hs,Io,No,Hs,Wo,jo,St,R,Uo,qs,Vo,Jo,Is,zo,Zo,Ns,Ko,Qo,Ot,B,Ws,Xo,Yo,js,go,ne,Us,se,ae,Rt,zn,te,Mt,rn,Bt,fn,pe,Vs,oe,ee,Tt,M,ce,Js,le,ue,zs,ke,ie,Zs,re,fe,Gt,dn,Ft,V,Ks,de,me,Qs,Ee,we,Lt,_,Xs,_e,ve,Ys,ye,$e,gs,be,Ce,na,xe,De,sa,Pe,Se,aa,Oe,Re,ta,Me,Be,At,v,Te,pa,Ge,Fe,oa,Le,Ae,ea,he,He,ca,qe,Ie,la,Ne,We,ua,je,Ue,ht,C,Ve,ka,Je,ze,ia,Ze,Ke,ra,Qe,Xe,fa,Ye,ge,Ht,qt,It,H,nc,da,sc,ac,ma,tc,pc,Nt,mn,Wt,En,oc,Ea,ec,cc,jt,T,wa,lc,uc,_a,kc,ic,va,rc,fc,Ut,y,ya,dc,mc,$a,Ec,wc,ba,_c,vc,Ca,yc,$c,xa,bc,Cc,Da,xc,Dc,Vt,Jt,zt,q,Pc,Pa,Sc,Oc,Sa,Rc,Mc,Zt,wn,Kt,Zn,Bc,Qt,Xt,Yt,_n,vn,Oa,Tc,gt,Kn,Gc,np,yn,sp,I,Fc,Ra,Lc,Ac,Ma,hc,Hc,ap,tp,pp,op,$n,bn,Ba,qc,ep,cp,lp,Qn,Ic,up,Xn,Nc,kp,N,Wc,Ta,jc,Uc,Ga,Vc,Jc,ip,Cn,rp,Yn,zc,fp,Bn,ik=`<code class="language-go"><span class="token keyword">case</span> <span class="token operator">&lt;-</span>mon<span class="token punctuation">.</span>Alert<span class="token punctuation">:</span>
			pprof<span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">"goroutine"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WriteTo</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code>`,dp,gn,Zc,mp,Ep,wp,ns,Kc,_p,ss,Qc,vp,Tn,rk=`<code class="language-go"><span class="token keyword">func</span> <span class="token function">timeoutStackTrace</span><span class="token punctuation">(</span>timeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">(</span>done <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  completed <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  done <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">close</span><span class="token punctuation">(</span>completed<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">:</span>
      pprof<span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">"goroutine"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WriteTo</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>completed<span class="token punctuation">:</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span></code>`,yp,J,Fa,Xc,Yc,La,gc,nl,$p,as,sl,bp,Gn,fk=`<code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>svc MyService<span class="token punctuation">)</span> <span class="token function">handler</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">defer</span> <span class="token function">timeoutStackTrace</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span></code>`,Cp,ts,al,xp,Dp,Pp,xn,tl,Aa,pl,ol,Sp,ps,el,Op,W,cl,ha,ll,ul,Ha,kl,il,Rp,Mp,Bp,Tp,Dn,Pn,qa,rl,Gp,Fp,Lp,os,z,Fn,es,bl,fl,dl,ml,Ln,El,Ap;return pn=new nn({props:{$$slots:{default:[bk]},$$scope:{ctx:w}}}),on=new nn({props:{$$slots:{default:[Ck]},$$scope:{ctx:w}}}),en=new nn({props:{$$slots:{default:[xk]},$$scope:{ctx:w}}}),rn=new nn({props:{$$slots:{default:[Dk]},$$scope:{ctx:w}}}),dn=new nn({props:{$$slots:{default:[Pk]},$$scope:{ctx:w}}}),mn=new nn({props:{$$slots:{default:[Sk]},$$scope:{ctx:w}}}),wn=new nn({props:{$$slots:{default:[Ok]},$$scope:{ctx:w}}}),yn=new nn({props:{$$slots:{default:[Rk]},$$scope:{ctx:w}}}),Cn=new nn({props:{$$slots:{default:[Mk]},$$scope:{ctx:w}}}),{c(){r=e("p"),E=t(`프로그램이 커지면 버그가 생기기 마련이고, 버그를 발견하면 무작정 디버깅부터 시작하는 것이 능사가 아니다.
특히 동시성 프로그램에서는 디버거가 도움이 되지 않는 경우가 많다.
이번 장에서는 동시성 프로그램에서 발생할 수 있는 버그를 어떻게 해결할 수 있는지 알아보자.`),f=k(),m=e("br"),Za=e("br"),Ka=k(),an=e("h2"),tn=e("a"),ws=e("span"),Ip=t("Stack Trace"),Qa=k(),Xa=e("hr"),Ya=k(),Hn=e("p"),Np=t(`운이 좋다면 panic에 빠진 프로그램이 여러 진단 정보를 출력할 것이다.
이 경우 소스코드의 어느 부분에서 문제가 발생했는지 알 수 있을 것이다.
데드락에 걸리기 쉬운 dining philosopher 문제를 통해 살펴보자.`),ga=k(),Z(pn.$$.fragment),nt=k(),qn=e("p"),Wp=t(`위 코드를 실행하면 얼마 지나지 않아 프로그램이 데드락에 걸린다.
이후 panic이 발생하고, 아래와 같은 스택 트레이스가 출력된다.`),st=k(),Z(on.$$.fragment),at=k(),P=e("p"),jp=t("스택 트레이스에서는 메인 고루틴의 "),_s=e("code"),Up=t("select"),Vp=t("문, 그리고 각 철학자 고루틴의 "),vs=e("code"),Jp=t("Lock"),zp=t(` 메서드에서 데드락이 발생했음을 알 수 있다.
스택 트레이스에서 `),ys=e("code"),Zp=t("runtime_SemacquireMutex"),Kp=t("라는 함수가 보이는데, 이는 Golang의 내부 함수로 레지스터상의 값을 읽어오기 때문에 런타임 디버거가 제대로 해석하지 못한다."),tt=k(),S=e("p"),Qp=t("이를 비롯하여 "),$s=e("code"),Xp=t("sync.(*Mutex).lockSlow(0xc00001a0b8)"),Yp=t(", "),bs=e("code"),gp=t("sync.(*Mutex).Lock(...)"),no=t(` 등의 함수들도 Golang의 내부 라이브러리 함수이다.
이때 `),Cs=e("code"),so=t("0xc00001a0b8"),ao=t("는 Lock을 호출한 Mutex의 주소를 나타낸다. 해당 주소를 가진 Mutex는 이미 Lock이 걸려있었음을 알 수 있다."),pt=k(),O=e("p"),to=t("스택 트레이스에서 명시된 "),xs=e("code"),po=t("tracing-deadlock.go:8"),oo=t("는 "),Ds=e("em"),eo=t("tracing-deadlock.go"),co=t(` 파일의 8번째 줄에서 데드락 발생 원인이 있다는 것을 알려준다.
또한 해당 고루틴이 `),Ps=e("em"),lo=t("tracing-deadlock.go"),uo=t(" 파일의 17번째 줄에서 생성되었음을 알 수 있다."),ot=k(),L=e("p"),ko=t("두 번째 철학자 고루틴에서는 "),Ss=e("code"),io=t("0xc00001a0b0"),ro=t("에 대한 Lock을 걸고 있다. 이 때 "),Os=e("code"),fo=t("0xc00001a0b0"),mo=t("은 첫 번째 철학자 고루틴이 이미 Lock을 걸었던 Mutex의 주소이다."),et=k(),In=e("p"),Eo=t("이처럼 스택 트레이스는 데드락이 발생한 곳을 찾는 데 도움이 된다. 또 다른 예시를 살펴보자."),ct=k(),Z(en.$$.fragment),lt=k(),Nn=e("p"),wo=t("이 프로그램은 공유 list에 값을 넣는 고루틴과, 값을 빼는 고루틴으로 구성되어 있다. 이 프로그램을 실행하면 매우 높은 확률로 panic이 발생하며, 아래와 같은 스택 트레이스가 출력된다."),ut=k(),Mn=e("pre"),kt=k(),b=e("p"),_o=t(`SIGSEGV는 segmentation fault이 발생한 경우를 나타내는 SIGNAL이며, 이는 유효하지 않은 메모리 주소에 접근했음을 의미한다.
스택 트레이스를 보면 `),Rs=e("code"),vo=t("0x10"),yo=t("에 접근할 때 SIGSEGV가 발생했음을 알 수 있고, "),Ms=e("code"),$o=t("0x10"),bo=t(`은 nil 포인터이다.
또한 스택 트레이스를 따라가다 보면 `),Bs=e("em"),Co=t("tracing-list.go"),xo=t(" 파일의 23번째 라인에서 호출한 "),Ts=e("code"),Do=t("Remove"),Po=t(" 메서드에서 nil 포인터에 접근했음을 알 수 있다."),it=k(),Wn=e("p"),So=t(`위 코드의 문제점은 어렵지 않게 찾을 수 있다. 공유 list에 값을 넣는 고루틴과 값을 빼는 고루틴이 동시에 접근하기 때문에 생기는 race condition으로 인한 문제이다.
nil 체크를 하는 것이 아니라, 뮤텍스를 사용하여 list 연산을 critical section으로 만들면 문제가 해결된다.`),rt=k(),jn=e("p"),Oo=t(`지금의 예제는 비교적 간단한 코드이기 때문에 문제를 진단하기 쉽지만, 실제 프로그램에서는 훨씬 복잡한 코드가 많다.
또한 대부분의 동시성 문제 해결은 golang의 내부 동작과 자료구조에 대한 심층적 이해를 요구하는 경우가 많다.
그러니 열심히 공부해야겠다ㅠ`),ft=k(),dt=e("br"),mt=e("br"),Et=k(),cn=e("h2"),ln=e("a"),Gs=e("span"),Ro=t("실패 감지 및 복구"),wt=k(),_t=e("hr"),vt=k(),Un=e("p"),Mo=t(`아무리 테스트를 잘 해도 프로그램은 실패하기 마련이다.
시스템이 예기치 않게 동작하는지 확인하기 위해 모든 환경적 요소를 테스트하는 것은 어렵기 때문이다.
거기에 동시성이 추가된 프로그램은 테스트하기 더 어려울 것이다.`),yt=k(),A=e("p"),Bo=t(`가령 메모리 누수 및 고루틴 누수가 발생하는 경우 프로그램이 out of memory로 인해 종료될 것이다.
Go 표준 라이브러리에는 이를 돕는 패키지가 있다.
`),Fs=e("code"),To=t("runtime/pprof"),Go=t(" 패키지는 CPU 및 힙 프로파일링을 통해 누수를 찾을 수 있도록 도와주며, "),Ls=e("code"),Fo=t("net/http/pprof"),Lo=t(" 패키지는 HTTP 서버를 통해 프로그램이 동작하면서 메모리를 어떻게 사용하는지 확인할 수 있도록 도와준다."),$t=k(),Vn=e("p"),Ao=t(`또한 어떤 종류의 오동작은 버그가 아니라 다른 시스템에 대한 의존성으로 인해 발생할 수도 있다.
특히 네트워크 통신 기반의 프로그램이 이에 해당한다.
그 외에도 중단된 서비스나 외부 라이브러리를 호출하는 경우가 있을 수 있다.`),bt=k(),Jn=e("p"),ho=t(`가장 실질적인 방법은 프로그램이 최대한 graceful하게 종료하고, 빠르게 재시작할 수 있도록 해야 한다.
클라우드 컴퓨팅 및 컨테이너 오케스트레이션을 통해 실패 감지 및 복구를 자동화할 수 있다.`),Ct=k(),xt=e("br"),Dt=k(),un=e("h3"),kn=e("a"),As=e("span"),Ho=t("실패 감지"),Pt=k(),h=e("p"),qo=t("오래 걸리지만 취소할 수 없는 함수 "),hs=e("code"),Io=t("SlowFunc"),No=t(`가 있다고 가정하자.
`),Hs=e("code"),Wo=t("SlowFunc"),jo=t("가 완료되기를 무한정 기다릴 수 없기 때문에 몇가지 방법을 생각해볼 수 있다."),St=k(),R=e("p"),Uo=t("먼저 타임아웃을 설정할 수 있다. 주어진 시간동안 "),qs=e("code"),Vo=t("SlowFunc"),Jo=t(`가 완료되지 않으면 타임아웃 에러를 반환한다.
하지만 `),Is=e("code"),zo=t("SlowFunc"),Zo=t("를 취소할 수는 없기 때문에, 타임아웃 에러를 반환하더라도 "),Ns=e("code"),Ko=t("SlowFunc"),Qo=t("는 별도의 고루틴에서 계속 실행된다."),Ot=k(),B=e("p"),Ws=e("code"),Xo=t("SlowFunc"),Yo=t("가 많은 리소스를 사용한다면 동시에 호출되는 "),js=e("code"),go=t("SlowFunc"),ne=t(`의 수를 제한할 수 있다.
만약 동시에 실행되는 `),Us=e("code"),se=t("SlowFunc"),ae=t(`의 수가 제한을 초과하면 즉시 에러를 반환한다.
그 외에도 최대 동시 호출된 함수 중 타임아웃을 초과하지 않고 응답 반환에 성공하는 함수가 없다면 경고를 출력한다.`),Rt=k(),zn=e("p"),te=t("위와 같은 요구사항을 기반으로 제네릭한 모니터링 타입을 작성한다."),Mt=k(),Z(rn.$$.fragment),Bt=k(),fn=e("p"),pe=t("해당 타입은 호출 타임아웃, 경고 타임아웃, 경고 채널, "),Vs=e("code"),oe=t("SlowFunc"),ee=t(" 함수, 활성화 채널, 동시 호출 수 제한 채널, 하트비트 채널을 필드로 가진다."),Tt=k(),M=e("p"),ce=t("이후 "),Js=e("code"),le=t("Monitor"),ue=t("의 필드인 "),zs=e("code"),ke=t("SlowFunc"),ie=t("를 호출하는 "),Zs=e("code"),re=t("Call"),fe=t(" 메서드를 작성한다."),Gt=k(),Z(dn.$$.fragment),Ft=k(),V=e("p"),Ks=e("code"),de=t("Call()"),me=t(" 메서드는 "),Qs=e("code"),Ee=t("SlowFunc"),we=t("를 호출하고, 결과에 따라 타임아웃 에러, Busy 에러, 정상적인 결과 중 하나를 반환한다."),Lt=k(),_=e("p"),Xs=e("code"),_e=t("Call()"),ve=t("이 호출되면 "),Ys=e("code"),ye=t("mon.active"),$e=t(`에 값을 전송하며, 이는 최대 동시 호출 수보다 현재 동시 호출 수가 적은 경우에만 가능하다.
만약 `),gs=e("code"),be=t("mon.active"),Ce=t("에 값을 전송할 수 없다면, "),na=e("code"),xe=t("mon.full"),De=t("에 값을 전송한다. 이 경우 최대 동시 호출 수를 초과했음을 의미하며, "),sa=e("code"),Pe=t("ErrBusy"),Se=t(`를 반환한다.
또한 `),aa=e("code"),Oe=t("mon.full"),Re=t("에 값을 전송할 수 없다면, 이 경우는 경고 타이머가 초기화되지 않았음을 의미하며, 동일하게 "),ta=e("code"),Me=t("ErrBusy"),Be=t("를 반환한다."),At=k(),v=e("p"),Te=t("이후 별도의 고루틴에서 "),pa=e("code"),Ge=t("SlowFunc"),Fe=t(`를 호출한다.
`),oa=e("code"),Le=t("SlowFunc"),Ae=t("가 호출된 이후 "),ea=e("code"),he=t("mon.active"),He=t("에서 값을 받아와서 다른 고루틴에서 "),ca=e("code"),qe=t("SlowFunc"),Ie=t("를 호출할 수 있도록 하며, 타이머를 초기화하기 위해 "),la=e("code"),Ne=t("mon.heartBeat"),We=t(`에 값을 전송한다.
타이머가 활성화되지 않아도 `),ua=e("code"),je=t("mon.heartBeat"),Ue=t("에 값을 전송할 수 있도록 하기 위해 비차단 전송을 사용하였다."),ht=k(),C=e("p"),Ve=t("마지막으로 "),ka=e("code"),Je=t("SlowFunc"),ze=t(`의 호출 결과를 받아온다.
이 때 `),ia=e("code"),Ze=t("mon.CallTimeout"),Ke=t(" 시간이 지나면 "),ra=e("code"),Qe=t("ErrTimeout"),Xe=t("을 반환하며, "),fa=e("code"),Ye=t("SlowFunc"),ge=t("의 반환값을 성공적으로 받아오면 해당 값을 반환한다."),Ht=k(),qt=e("br"),It=k(),H=e("p"),nc=t(`다음으로 모니터링 고루틴을 작성해보자.
`),da=e("code"),sc=t("NewMonitor"),ac=t("함수는 "),ma=e("code"),tc=t("Monitor"),pc=t(" 타입의 인스턴스를 생성하며, 모니터링 고루틴을 실행한다."),Nt=k(),Z(mn.$$.fragment),Wt=k(),En=e("p"),oc=t("모니터 고루틴은 "),Ea=e("code"),ec=t("timer"),cc=t("가 nil일 때, nil이 아닐 때로 구분된다."),jt=k(),T=e("p"),wa=e("code"),lc=t("timer"),uc=t("가 nil일 때는 돌아가고 있는 고루틴의 수가 "),_a=e("code"),kc=t("maxActive"),ic=t(`보다 작은 경우이므로 경고 타이머가 필요하지 않다.
이 경우에는 `),va=e("code"),rc=t("mon.full"),fc=t(" 채널에서 값을 받아올 때까지 대기하며, 값을 받아오면 경고 타이머를 초기화한다."),Ut=k(),y=e("p"),ya=e("code"),dc=t("timer"),mc=t(`가 nil이 아닐 때는 경고 타이머가 활성화된 경우이다.
각각 `),$a=e("code"),Ec=t("mon.heartBeat"),wc=t(", "),ba=e("code"),_c=t("timer.C"),vc=t(", "),Ca=e("code"),yc=t("mon.Done"),$c=t(" 채널에서 값을 받아올 때까지 대기하며, "),xa=e("code"),bc=t("mon.heartBeat"),Cc=t(` 채널에서 값을 받아오면 경고 타이머를 초기화한다.
만약 `),Da=e("code"),xc=t("timer.C"),Dc=t("에서 먼저 값을 받아오면 경고를 보낸다."),Vt=k(),Jt=e("br"),zt=k(),q=e("p"),Pc=t("이렇게 작성한 "),Pa=e("code"),Sc=t("Monitor"),Oc=t(" 타입을 사용하여 "),Sa=e("code"),Rc=t("SlowFunc"),Mc=t("를 호출하는 코드를 작성해보자."),Zt=k(),Z(wn.$$.fragment),Kt=k(),Zn=e("p"),Bc=t(`사실 이 상황에서는 실패를 감지하더라도 마땅히 할 수 있는 것이 많지 않다.
기껏해야 이메일이나 슬랙으로 알림을 보내는 정도일 것이다.`),Qt=k(),Xt=e("br"),Yt=k(),_n=e("h3"),vn=e("a"),Oa=e("span"),Tc=t("재시작"),gt=k(),Kn=e("p"),Gc=t("고루틴이 일정 시간 응답이 없는 경우, 그냥 고루틴을 다시 시작하는 것이 좋은 방법일 때도 있다."),np=k(),Z(yn.$$.fragment),sp=k(),I=e("p"),Fc=t("장기 실행되는 함수는 실패하거나 다른 여러 이유로 하트비트를 보내지 못할 수 있다. 100밀리초마다 "),Ra=e("code"),Lc=t("heartBeat"),Ac=t(" 채널로부터 값을 읽지 못하면, "),Ma=e("code"),hc=t("f"),Hc=t(" 함수를 실행한다."),ap=k(),tp=e("br"),pp=e("br"),op=k(),$n=e("h2"),bn=e("a"),Ba=e("span"),qc=t("디버깅"),ep=k(),cp=e("hr"),lp=k(),Qn=e("p"),Ic=t(`동시성 프로그램은 거의 양자역학이다. 디버깅할 땐 잘 됐다가 프로덕션에서 에러가 발생하는 경우가 많다.
물론 에러가 났을 때 스택 트레이스로 진단 정보를 확인할 수 있는 경우도 많지만, 그것조차 없어 디버깅하기 곤란한 경우도 있다.`),up=k(),Xn=e("p"),Nc=t(`동시성 프로그램에서 문제가 언제 발생할지는 모르지만, 해당 문제가 발생한다는 사실 자체는 알고 있다.
따라서 해당 지점에서 모든 진단 정보를 출력하는 것이 좋다.`),kp=k(),N=e("p"),Wc=t("다음은 앞선 "),Ta=e("code"),jc=t("Monitor"),Uc=t(" 예제의 "),Ga=e("code"),Vc=t("main"),Jc=t(" 함수이다."),ip=k(),Z(Cn.$$.fragment),rp=k(),Yn=e("p"),zc=t("다음 라인이 스택 트레이스를 출력하는 부분이다."),fp=k(),Bn=e("pre"),dp=k(),gn=e("p"),Zc=t("이렇게 하면 활성 고루틴의 스택 트레이스 및 진단 정보를 출력할 수 있다."),mp=k(),Ep=e("br"),wp=k(),ns=e("p"),Kc=t(`데드락을 진단하는 것도 쉽지 않다.
모든 고루틴이 데드락에 걸리면 패닉이 발생하고, 스택 트레이스를 출력할 수 있지만, 고루틴이 하나라도 살아있는 상황에서 다른 고루틴이 데드락에 걸리면 패닉이 발생하지 않는다.
이 경우 데드락에 빠진 고루틴은 누수를 일으킨다.`),_p=k(),ss=e("p"),Qc=t("누수가 의심된다면 몇가지 방법을 시도해볼 수 있다."),vp=k(),Tn=e("pre"),yp=k(),J=e("p"),Fa=e("code"),Xc=t("timeoutStackTrace"),Yc=t(" 함수는 "),La=e("code"),gc=t("done"),nl=t(` 함수의 호출 또는 timeout 만료 이전까지 기다리며, timeout이 만료되면 스택 트레이스를 출력한다.
따라서 타임아웃이 발생하면 그 원인을 찾을 수 있다.`),$p=k(),as=e("p"),sl=t("다음과 같이 사용할 수 있다."),bp=k(),Gn=e("pre"),Cp=k(),ts=e("p"),al=t("이렇듯 데드락에 걸리거나 응답이 없는 고루틴이 있는 것 같다면, 해당 문제를 감지한 이후 스택 트레이스를 출력하는 방법은 꽤 유용할 것이다."),xp=k(),Dp=e("br"),Pp=k(),xn=e("p"),tl=t(`race condition을 처리하는 건 더 어렵다.
좋은 방법 중 하나는 race condition이 발생하는 것으로 의심되는 부분을 찾아서 복제하고 유닛 테스트를 돌리는 것이다.
Go의 race detector(`),Aa=e("code"),pl=t("-race"),ol=t(` 플래그)를 사용하면 된다.
race detector는 memory race를 관측하면 이를 보고한다.`),Sp=k(),ps=e("p"),el=t("하지만 race detector는 race가 발생할 때만 감지할 수 있기 때문에, detector가 돌아갈 때 race가 발생하지 않았다고 해도 race가 발생하지 않는다고 속단할 수 없다."),Op=k(),W=e("p"),cl=t(`race condition은 대부분 자료구조를 오염시키는 형태로 발생한다. 이를 해결하기 위해서는 자사 및 외부 라이브러리의 기나긴 코드 리딩 시간을 거쳐가게 될 것이다.
중간중간에 `),ha=e("code"),ll=t("fmt.Println"),ul=t("이나 "),Ha=e("code"),kl=t("panic"),il=t("을 집어넣어서 어떤 상태인지 확인하는 것도 좋은 습관이다."),Rp=k(),Mp=e("br"),Bp=e("br"),Tp=k(),Dn=e("h2"),Pn=e("a"),qa=e("span"),rl=t("References"),Gp=k(),Fp=e("hr"),Lp=k(),os=e("center"),z=e("p"),Fn=e("a"),es=e("img"),fl=k(),dl=e("br"),ml=k(),Ln=e("a"),El=t("Jon Bodner, 『Learning Go』, O’Reilly Media, Inc."),this.h()},l(n){r=c(n,"P",{});var o=u(r);E=p(o,`프로그램이 커지면 버그가 생기기 마련이고, 버그를 발견하면 무작정 디버깅부터 시작하는 것이 능사가 아니다.
특히 동시성 프로그램에서는 디버거가 도움이 되지 않는 경우가 많다.
이번 장에서는 동시성 프로그램에서 발생할 수 있는 버그를 어떻게 해결할 수 있는지 알아보자.`),o.forEach(s),f=i(n),m=c(n,"BR",{}),Za=c(n,"BR",{}),Ka=i(n),an=c(n,"H2",{id:!0});var cs=u(an);tn=c(cs,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Ia=u(tn);ws=c(Ia,"SPAN",{class:!0}),u(ws).forEach(s),Ia.forEach(s),Ip=p(cs,"Stack Trace"),cs.forEach(s),Qa=i(n),Xa=c(n,"HR",{}),Ya=i(n),Hn=c(n,"P",{});var Na=u(Hn);Np=p(Na,`운이 좋다면 panic에 빠진 프로그램이 여러 진단 정보를 출력할 것이다.
이 경우 소스코드의 어느 부분에서 문제가 발생했는지 알 수 있을 것이다.
데드락에 걸리기 쉬운 dining philosopher 문제를 통해 살펴보자.`),Na.forEach(s),ga=i(n),K(pn.$$.fragment,n),nt=i(n),qn=c(n,"P",{});var Wa=u(qn);Wp=p(Wa,`위 코드를 실행하면 얼마 지나지 않아 프로그램이 데드락에 걸린다.
이후 panic이 발생하고, 아래와 같은 스택 트레이스가 출력된다.`),Wa.forEach(s),st=i(n),K(on.$$.fragment,n),at=i(n),P=c(n,"P",{});var G=u(P);jp=p(G,"스택 트레이스에서는 메인 고루틴의 "),_s=c(G,"CODE",{});var ja=u(_s);Up=p(ja,"select"),ja.forEach(s),Vp=p(G,"문, 그리고 각 철학자 고루틴의 "),vs=c(G,"CODE",{});var Ua=u(vs);Jp=p(Ua,"Lock"),Ua.forEach(s),zp=p(G,` 메서드에서 데드락이 발생했음을 알 수 있다.
스택 트레이스에서 `),ys=c(G,"CODE",{});var Va=u(ys);Zp=p(Va,"runtime_SemacquireMutex"),Va.forEach(s),Kp=p(G,"라는 함수가 보이는데, 이는 Golang의 내부 함수로 레지스터상의 값을 읽어오기 때문에 런타임 디버거가 제대로 해석하지 못한다."),G.forEach(s),tt=i(n),S=c(n,"P",{});var F=u(S);Qp=p(F,"이를 비롯하여 "),$s=c(F,"CODE",{});var Cl=u($s);Xp=p(Cl,"sync.(*Mutex).lockSlow(0xc00001a0b8)"),Cl.forEach(s),Yp=p(F,", "),bs=c(F,"CODE",{});var xl=u(bs);gp=p(xl,"sync.(*Mutex).Lock(...)"),xl.forEach(s),no=p(F,` 등의 함수들도 Golang의 내부 라이브러리 함수이다.
이때 `),Cs=c(F,"CODE",{});var Dl=u(Cs);so=p(Dl,"0xc00001a0b8"),Dl.forEach(s),ao=p(F,"는 Lock을 호출한 Mutex의 주소를 나타낸다. 해당 주소를 가진 Mutex는 이미 Lock이 걸려있었음을 알 수 있다."),F.forEach(s),pt=i(n),O=c(n,"P",{});var Sn=u(O);to=p(Sn,"스택 트레이스에서 명시된 "),xs=c(Sn,"CODE",{});var Pl=u(xs);po=p(Pl,"tracing-deadlock.go:8"),Pl.forEach(s),oo=p(Sn,"는 "),Ds=c(Sn,"EM",{});var Sl=u(Ds);eo=p(Sl,"tracing-deadlock.go"),Sl.forEach(s),co=p(Sn,` 파일의 8번째 줄에서 데드락 발생 원인이 있다는 것을 알려준다.
또한 해당 고루틴이 `),Ps=c(Sn,"EM",{});var Ol=u(Ps);lo=p(Ol,"tracing-deadlock.go"),Ol.forEach(s),uo=p(Sn," 파일의 17번째 줄에서 생성되었음을 알 수 있다."),Sn.forEach(s),ot=i(n),L=c(n,"P",{});var ls=u(L);ko=p(ls,"두 번째 철학자 고루틴에서는 "),Ss=c(ls,"CODE",{});var Rl=u(Ss);io=p(Rl,"0xc00001a0b0"),Rl.forEach(s),ro=p(ls,"에 대한 Lock을 걸고 있다. 이 때 "),Os=c(ls,"CODE",{});var Ml=u(Os);fo=p(Ml,"0xc00001a0b0"),Ml.forEach(s),mo=p(ls,"은 첫 번째 철학자 고루틴이 이미 Lock을 걸었던 Mutex의 주소이다."),ls.forEach(s),et=i(n),In=c(n,"P",{});var Bl=u(In);Eo=p(Bl,"이처럼 스택 트레이스는 데드락이 발생한 곳을 찾는 데 도움이 된다. 또 다른 예시를 살펴보자."),Bl.forEach(s),ct=i(n),K(en.$$.fragment,n),lt=i(n),Nn=c(n,"P",{});var Tl=u(Nn);wo=p(Tl,"이 프로그램은 공유 list에 값을 넣는 고루틴과, 값을 빼는 고루틴으로 구성되어 있다. 이 프로그램을 실행하면 매우 높은 확률로 panic이 발생하며, 아래와 같은 스택 트레이스가 출력된다."),Tl.forEach(s),ut=i(n),Mn=c(n,"PRE",{class:!0});var dk=u(Mn);dk.forEach(s),kt=i(n),b=c(n,"P",{});var j=u(b);_o=p(j,`SIGSEGV는 segmentation fault이 발생한 경우를 나타내는 SIGNAL이며, 이는 유효하지 않은 메모리 주소에 접근했음을 의미한다.
스택 트레이스를 보면 `),Rs=c(j,"CODE",{});var Gl=u(Rs);vo=p(Gl,"0x10"),Gl.forEach(s),yo=p(j,"에 접근할 때 SIGSEGV가 발생했음을 알 수 있고, "),Ms=c(j,"CODE",{});var Fl=u(Ms);$o=p(Fl,"0x10"),Fl.forEach(s),bo=p(j,`은 nil 포인터이다.
또한 스택 트레이스를 따라가다 보면 `),Bs=c(j,"EM",{});var Ll=u(Bs);Co=p(Ll,"tracing-list.go"),Ll.forEach(s),xo=p(j," 파일의 23번째 라인에서 호출한 "),Ts=c(j,"CODE",{});var Al=u(Ts);Do=p(Al,"Remove"),Al.forEach(s),Po=p(j," 메서드에서 nil 포인터에 접근했음을 알 수 있다."),j.forEach(s),it=i(n),Wn=c(n,"P",{});var hl=u(Wn);So=p(hl,`위 코드의 문제점은 어렵지 않게 찾을 수 있다. 공유 list에 값을 넣는 고루틴과 값을 빼는 고루틴이 동시에 접근하기 때문에 생기는 race condition으로 인한 문제이다.
nil 체크를 하는 것이 아니라, 뮤텍스를 사용하여 list 연산을 critical section으로 만들면 문제가 해결된다.`),hl.forEach(s),rt=i(n),jn=c(n,"P",{});var Hl=u(jn);Oo=p(Hl,`지금의 예제는 비교적 간단한 코드이기 때문에 문제를 진단하기 쉽지만, 실제 프로그램에서는 훨씬 복잡한 코드가 많다.
또한 대부분의 동시성 문제 해결은 golang의 내부 동작과 자료구조에 대한 심층적 이해를 요구하는 경우가 많다.
그러니 열심히 공부해야겠다ㅠ`),Hl.forEach(s),ft=i(n),dt=c(n,"BR",{}),mt=c(n,"BR",{}),Et=i(n),cn=c(n,"H2",{id:!0});var wl=u(cn);ln=c(wl,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var ql=u(ln);Gs=c(ql,"SPAN",{class:!0}),u(Gs).forEach(s),ql.forEach(s),Ro=p(wl,"실패 감지 및 복구"),wl.forEach(s),wt=i(n),_t=c(n,"HR",{}),vt=i(n),Un=c(n,"P",{});var Il=u(Un);Mo=p(Il,`아무리 테스트를 잘 해도 프로그램은 실패하기 마련이다.
시스템이 예기치 않게 동작하는지 확인하기 위해 모든 환경적 요소를 테스트하는 것은 어렵기 때문이다.
거기에 동시성이 추가된 프로그램은 테스트하기 더 어려울 것이다.`),Il.forEach(s),yt=i(n),A=c(n,"P",{});var us=u(A);Bo=p(us,`가령 메모리 누수 및 고루틴 누수가 발생하는 경우 프로그램이 out of memory로 인해 종료될 것이다.
Go 표준 라이브러리에는 이를 돕는 패키지가 있다.
`),Fs=c(us,"CODE",{});var Nl=u(Fs);To=p(Nl,"runtime/pprof"),Nl.forEach(s),Go=p(us," 패키지는 CPU 및 힙 프로파일링을 통해 누수를 찾을 수 있도록 도와주며, "),Ls=c(us,"CODE",{});var Wl=u(Ls);Fo=p(Wl,"net/http/pprof"),Wl.forEach(s),Lo=p(us," 패키지는 HTTP 서버를 통해 프로그램이 동작하면서 메모리를 어떻게 사용하는지 확인할 수 있도록 도와준다."),us.forEach(s),$t=i(n),Vn=c(n,"P",{});var jl=u(Vn);Ao=p(jl,`또한 어떤 종류의 오동작은 버그가 아니라 다른 시스템에 대한 의존성으로 인해 발생할 수도 있다.
특히 네트워크 통신 기반의 프로그램이 이에 해당한다.
그 외에도 중단된 서비스나 외부 라이브러리를 호출하는 경우가 있을 수 있다.`),jl.forEach(s),bt=i(n),Jn=c(n,"P",{});var Ul=u(Jn);ho=p(Ul,`가장 실질적인 방법은 프로그램이 최대한 graceful하게 종료하고, 빠르게 재시작할 수 있도록 해야 한다.
클라우드 컴퓨팅 및 컨테이너 오케스트레이션을 통해 실패 감지 및 복구를 자동화할 수 있다.`),Ul.forEach(s),Ct=i(n),xt=c(n,"BR",{}),Dt=i(n),un=c(n,"H3",{id:!0});var _l=u(un);kn=c(_l,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Vl=u(kn);As=c(Vl,"SPAN",{class:!0}),u(As).forEach(s),Vl.forEach(s),Ho=p(_l,"실패 감지"),_l.forEach(s),Pt=i(n),h=c(n,"P",{});var ks=u(h);qo=p(ks,"오래 걸리지만 취소할 수 없는 함수 "),hs=c(ks,"CODE",{});var Jl=u(hs);Io=p(Jl,"SlowFunc"),Jl.forEach(s),No=p(ks,`가 있다고 가정하자.
`),Hs=c(ks,"CODE",{});var zl=u(Hs);Wo=p(zl,"SlowFunc"),zl.forEach(s),jo=p(ks,"가 완료되기를 무한정 기다릴 수 없기 때문에 몇가지 방법을 생각해볼 수 있다."),ks.forEach(s),St=i(n),R=c(n,"P",{});var On=u(R);Uo=p(On,"먼저 타임아웃을 설정할 수 있다. 주어진 시간동안 "),qs=c(On,"CODE",{});var Zl=u(qs);Vo=p(Zl,"SlowFunc"),Zl.forEach(s),Jo=p(On,`가 완료되지 않으면 타임아웃 에러를 반환한다.
하지만 `),Is=c(On,"CODE",{});var Kl=u(Is);zo=p(Kl,"SlowFunc"),Kl.forEach(s),Zo=p(On,"를 취소할 수는 없기 때문에, 타임아웃 에러를 반환하더라도 "),Ns=c(On,"CODE",{});var Ql=u(Ns);Ko=p(Ql,"SlowFunc"),Ql.forEach(s),Qo=p(On,"는 별도의 고루틴에서 계속 실행된다."),On.forEach(s),Ot=i(n),B=c(n,"P",{});var An=u(B);Ws=c(An,"CODE",{});var Xl=u(Ws);Xo=p(Xl,"SlowFunc"),Xl.forEach(s),Yo=p(An,"가 많은 리소스를 사용한다면 동시에 호출되는 "),js=c(An,"CODE",{});var Yl=u(js);go=p(Yl,"SlowFunc"),Yl.forEach(s),ne=p(An,`의 수를 제한할 수 있다.
만약 동시에 실행되는 `),Us=c(An,"CODE",{});var gl=u(Us);se=p(gl,"SlowFunc"),gl.forEach(s),ae=p(An,`의 수가 제한을 초과하면 즉시 에러를 반환한다.
그 외에도 최대 동시 호출된 함수 중 타임아웃을 초과하지 않고 응답 반환에 성공하는 함수가 없다면 경고를 출력한다.`),An.forEach(s),Rt=i(n),zn=c(n,"P",{});var nu=u(zn);te=p(nu,"위와 같은 요구사항을 기반으로 제네릭한 모니터링 타입을 작성한다."),nu.forEach(s),Mt=i(n),K(rn.$$.fragment,n),Bt=i(n),fn=c(n,"P",{});var hp=u(fn);pe=p(hp,"해당 타입은 호출 타임아웃, 경고 타임아웃, 경고 채널, "),Vs=c(hp,"CODE",{});var su=u(Vs);oe=p(su,"SlowFunc"),su.forEach(s),ee=p(hp," 함수, 활성화 채널, 동시 호출 수 제한 채널, 하트비트 채널을 필드로 가진다."),hp.forEach(s),Tt=i(n),M=c(n,"P",{});var Rn=u(M);ce=p(Rn,"이후 "),Js=c(Rn,"CODE",{});var au=u(Js);le=p(au,"Monitor"),au.forEach(s),ue=p(Rn,"의 필드인 "),zs=c(Rn,"CODE",{});var tu=u(zs);ke=p(tu,"SlowFunc"),tu.forEach(s),ie=p(Rn,"를 호출하는 "),Zs=c(Rn,"CODE",{});var pu=u(Zs);re=p(pu,"Call"),pu.forEach(s),fe=p(Rn," 메서드를 작성한다."),Rn.forEach(s),Gt=i(n),K(dn.$$.fragment,n),Ft=i(n),V=c(n,"P",{});var Ja=u(V);Ks=c(Ja,"CODE",{});var ou=u(Ks);de=p(ou,"Call()"),ou.forEach(s),me=p(Ja," 메서드는 "),Qs=c(Ja,"CODE",{});var eu=u(Qs);Ee=p(eu,"SlowFunc"),eu.forEach(s),we=p(Ja,"를 호출하고, 결과에 따라 타임아웃 에러, Busy 에러, 정상적인 결과 중 하나를 반환한다."),Ja.forEach(s),Lt=i(n),_=c(n,"P",{});var $=u(_);Xs=c($,"CODE",{});var cu=u(Xs);_e=p(cu,"Call()"),cu.forEach(s),ve=p($,"이 호출되면 "),Ys=c($,"CODE",{});var lu=u(Ys);ye=p(lu,"mon.active"),lu.forEach(s),$e=p($,`에 값을 전송하며, 이는 최대 동시 호출 수보다 현재 동시 호출 수가 적은 경우에만 가능하다.
만약 `),gs=c($,"CODE",{});var uu=u(gs);be=p(uu,"mon.active"),uu.forEach(s),Ce=p($,"에 값을 전송할 수 없다면, "),na=c($,"CODE",{});var ku=u(na);xe=p(ku,"mon.full"),ku.forEach(s),De=p($,"에 값을 전송한다. 이 경우 최대 동시 호출 수를 초과했음을 의미하며, "),sa=c($,"CODE",{});var iu=u(sa);Pe=p(iu,"ErrBusy"),iu.forEach(s),Se=p($,`를 반환한다.
또한 `),aa=c($,"CODE",{});var ru=u(aa);Oe=p(ru,"mon.full"),ru.forEach(s),Re=p($,"에 값을 전송할 수 없다면, 이 경우는 경고 타이머가 초기화되지 않았음을 의미하며, 동일하게 "),ta=c($,"CODE",{});var fu=u(ta);Me=p(fu,"ErrBusy"),fu.forEach(s),Be=p($,"를 반환한다."),$.forEach(s),At=i(n),v=c(n,"P",{});var x=u(v);Te=p(x,"이후 별도의 고루틴에서 "),pa=c(x,"CODE",{});var du=u(pa);Ge=p(du,"SlowFunc"),du.forEach(s),Fe=p(x,`를 호출한다.
`),oa=c(x,"CODE",{});var mu=u(oa);Le=p(mu,"SlowFunc"),mu.forEach(s),Ae=p(x,"가 호출된 이후 "),ea=c(x,"CODE",{});var Eu=u(ea);he=p(Eu,"mon.active"),Eu.forEach(s),He=p(x,"에서 값을 받아와서 다른 고루틴에서 "),ca=c(x,"CODE",{});var wu=u(ca);qe=p(wu,"SlowFunc"),wu.forEach(s),Ie=p(x,"를 호출할 수 있도록 하며, 타이머를 초기화하기 위해 "),la=c(x,"CODE",{});var _u=u(la);Ne=p(_u,"mon.heartBeat"),_u.forEach(s),We=p(x,`에 값을 전송한다.
타이머가 활성화되지 않아도 `),ua=c(x,"CODE",{});var vu=u(ua);je=p(vu,"mon.heartBeat"),vu.forEach(s),Ue=p(x,"에 값을 전송할 수 있도록 하기 위해 비차단 전송을 사용하였다."),x.forEach(s),ht=i(n),C=c(n,"P",{});var U=u(C);Ve=p(U,"마지막으로 "),ka=c(U,"CODE",{});var yu=u(ka);Je=p(yu,"SlowFunc"),yu.forEach(s),ze=p(U,`의 호출 결과를 받아온다.
이 때 `),ia=c(U,"CODE",{});var $u=u(ia);Ze=p($u,"mon.CallTimeout"),$u.forEach(s),Ke=p(U," 시간이 지나면 "),ra=c(U,"CODE",{});var bu=u(ra);Qe=p(bu,"ErrTimeout"),bu.forEach(s),Xe=p(U,"을 반환하며, "),fa=c(U,"CODE",{});var Cu=u(fa);Ye=p(Cu,"SlowFunc"),Cu.forEach(s),ge=p(U,"의 반환값을 성공적으로 받아오면 해당 값을 반환한다."),U.forEach(s),Ht=i(n),qt=c(n,"BR",{}),It=i(n),H=c(n,"P",{});var is=u(H);nc=p(is,`다음으로 모니터링 고루틴을 작성해보자.
`),da=c(is,"CODE",{});var xu=u(da);sc=p(xu,"NewMonitor"),xu.forEach(s),ac=p(is,"함수는 "),ma=c(is,"CODE",{});var Du=u(ma);tc=p(Du,"Monitor"),Du.forEach(s),pc=p(is," 타입의 인스턴스를 생성하며, 모니터링 고루틴을 실행한다."),is.forEach(s),Nt=i(n),K(mn.$$.fragment,n),Wt=i(n),En=c(n,"P",{});var Hp=u(En);oc=p(Hp,"모니터 고루틴은 "),Ea=c(Hp,"CODE",{});var Pu=u(Ea);ec=p(Pu,"timer"),Pu.forEach(s),cc=p(Hp,"가 nil일 때, nil이 아닐 때로 구분된다."),Hp.forEach(s),jt=i(n),T=c(n,"P",{});var hn=u(T);wa=c(hn,"CODE",{});var Su=u(wa);lc=p(Su,"timer"),Su.forEach(s),uc=p(hn,"가 nil일 때는 돌아가고 있는 고루틴의 수가 "),_a=c(hn,"CODE",{});var Ou=u(_a);kc=p(Ou,"maxActive"),Ou.forEach(s),ic=p(hn,`보다 작은 경우이므로 경고 타이머가 필요하지 않다.
이 경우에는 `),va=c(hn,"CODE",{});var Ru=u(va);rc=p(Ru,"mon.full"),Ru.forEach(s),fc=p(hn," 채널에서 값을 받아올 때까지 대기하며, 값을 받아오면 경고 타이머를 초기화한다."),hn.forEach(s),Ut=i(n),y=c(n,"P",{});var D=u(y);ya=c(D,"CODE",{});var Mu=u(ya);dc=p(Mu,"timer"),Mu.forEach(s),mc=p(D,`가 nil이 아닐 때는 경고 타이머가 활성화된 경우이다.
각각 `),$a=c(D,"CODE",{});var Bu=u($a);Ec=p(Bu,"mon.heartBeat"),Bu.forEach(s),wc=p(D,", "),ba=c(D,"CODE",{});var Tu=u(ba);_c=p(Tu,"timer.C"),Tu.forEach(s),vc=p(D,", "),Ca=c(D,"CODE",{});var Gu=u(Ca);yc=p(Gu,"mon.Done"),Gu.forEach(s),$c=p(D," 채널에서 값을 받아올 때까지 대기하며, "),xa=c(D,"CODE",{});var Fu=u(xa);bc=p(Fu,"mon.heartBeat"),Fu.forEach(s),Cc=p(D,` 채널에서 값을 받아오면 경고 타이머를 초기화한다.
만약 `),Da=c(D,"CODE",{});var Lu=u(Da);xc=p(Lu,"timer.C"),Lu.forEach(s),Dc=p(D,"에서 먼저 값을 받아오면 경고를 보낸다."),D.forEach(s),Vt=i(n),Jt=c(n,"BR",{}),zt=i(n),q=c(n,"P",{});var rs=u(q);Pc=p(rs,"이렇게 작성한 "),Pa=c(rs,"CODE",{});var Au=u(Pa);Sc=p(Au,"Monitor"),Au.forEach(s),Oc=p(rs," 타입을 사용하여 "),Sa=c(rs,"CODE",{});var hu=u(Sa);Rc=p(hu,"SlowFunc"),hu.forEach(s),Mc=p(rs,"를 호출하는 코드를 작성해보자."),rs.forEach(s),Zt=i(n),K(wn.$$.fragment,n),Kt=i(n),Zn=c(n,"P",{});var Hu=u(Zn);Bc=p(Hu,`사실 이 상황에서는 실패를 감지하더라도 마땅히 할 수 있는 것이 많지 않다.
기껏해야 이메일이나 슬랙으로 알림을 보내는 정도일 것이다.`),Hu.forEach(s),Qt=i(n),Xt=c(n,"BR",{}),Yt=i(n),_n=c(n,"H3",{id:!0});var vl=u(_n);vn=c(vl,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var qu=u(vn);Oa=c(qu,"SPAN",{class:!0}),u(Oa).forEach(s),qu.forEach(s),Tc=p(vl,"재시작"),vl.forEach(s),gt=i(n),Kn=c(n,"P",{});var Iu=u(Kn);Gc=p(Iu,"고루틴이 일정 시간 응답이 없는 경우, 그냥 고루틴을 다시 시작하는 것이 좋은 방법일 때도 있다."),Iu.forEach(s),np=i(n),K(yn.$$.fragment,n),sp=i(n),I=c(n,"P",{});var fs=u(I);Fc=p(fs,"장기 실행되는 함수는 실패하거나 다른 여러 이유로 하트비트를 보내지 못할 수 있다. 100밀리초마다 "),Ra=c(fs,"CODE",{});var Nu=u(Ra);Lc=p(Nu,"heartBeat"),Nu.forEach(s),Ac=p(fs," 채널로부터 값을 읽지 못하면, "),Ma=c(fs,"CODE",{});var Wu=u(Ma);hc=p(Wu,"f"),Wu.forEach(s),Hc=p(fs," 함수를 실행한다."),fs.forEach(s),ap=i(n),tp=c(n,"BR",{}),pp=c(n,"BR",{}),op=i(n),$n=c(n,"H2",{id:!0});var yl=u($n);bn=c(yl,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var ju=u(bn);Ba=c(ju,"SPAN",{class:!0}),u(Ba).forEach(s),ju.forEach(s),qc=p(yl,"디버깅"),yl.forEach(s),ep=i(n),cp=c(n,"HR",{}),lp=i(n),Qn=c(n,"P",{});var Uu=u(Qn);Ic=p(Uu,`동시성 프로그램은 거의 양자역학이다. 디버깅할 땐 잘 됐다가 프로덕션에서 에러가 발생하는 경우가 많다.
물론 에러가 났을 때 스택 트레이스로 진단 정보를 확인할 수 있는 경우도 많지만, 그것조차 없어 디버깅하기 곤란한 경우도 있다.`),Uu.forEach(s),up=i(n),Xn=c(n,"P",{});var Vu=u(Xn);Nc=p(Vu,`동시성 프로그램에서 문제가 언제 발생할지는 모르지만, 해당 문제가 발생한다는 사실 자체는 알고 있다.
따라서 해당 지점에서 모든 진단 정보를 출력하는 것이 좋다.`),Vu.forEach(s),kp=i(n),N=c(n,"P",{});var ds=u(N);Wc=p(ds,"다음은 앞선 "),Ta=c(ds,"CODE",{});var Ju=u(Ta);jc=p(Ju,"Monitor"),Ju.forEach(s),Uc=p(ds," 예제의 "),Ga=c(ds,"CODE",{});var zu=u(Ga);Vc=p(zu,"main"),zu.forEach(s),Jc=p(ds," 함수이다."),ds.forEach(s),ip=i(n),K(Cn.$$.fragment,n),rp=i(n),Yn=c(n,"P",{});var Zu=u(Yn);zc=p(Zu,"다음 라인이 스택 트레이스를 출력하는 부분이다."),Zu.forEach(s),fp=i(n),Bn=c(n,"PRE",{class:!0});var mk=u(Bn);mk.forEach(s),dp=i(n),gn=c(n,"P",{});var Ku=u(gn);Zc=p(Ku,"이렇게 하면 활성 고루틴의 스택 트레이스 및 진단 정보를 출력할 수 있다."),Ku.forEach(s),mp=i(n),Ep=c(n,"BR",{}),wp=i(n),ns=c(n,"P",{});var Qu=u(ns);Kc=p(Qu,`데드락을 진단하는 것도 쉽지 않다.
모든 고루틴이 데드락에 걸리면 패닉이 발생하고, 스택 트레이스를 출력할 수 있지만, 고루틴이 하나라도 살아있는 상황에서 다른 고루틴이 데드락에 걸리면 패닉이 발생하지 않는다.
이 경우 데드락에 빠진 고루틴은 누수를 일으킨다.`),Qu.forEach(s),_p=i(n),ss=c(n,"P",{});var Xu=u(ss);Qc=p(Xu,"누수가 의심된다면 몇가지 방법을 시도해볼 수 있다."),Xu.forEach(s),vp=i(n),Tn=c(n,"PRE",{class:!0});var Ek=u(Tn);Ek.forEach(s),yp=i(n),J=c(n,"P",{});var za=u(J);Fa=c(za,"CODE",{});var Yu=u(Fa);Xc=p(Yu,"timeoutStackTrace"),Yu.forEach(s),Yc=p(za," 함수는 "),La=c(za,"CODE",{});var gu=u(La);gc=p(gu,"done"),gu.forEach(s),nl=p(za,` 함수의 호출 또는 timeout 만료 이전까지 기다리며, timeout이 만료되면 스택 트레이스를 출력한다.
따라서 타임아웃이 발생하면 그 원인을 찾을 수 있다.`),za.forEach(s),$p=i(n),as=c(n,"P",{});var nk=u(as);sl=p(nk,"다음과 같이 사용할 수 있다."),nk.forEach(s),bp=i(n),Gn=c(n,"PRE",{class:!0});var wk=u(Gn);wk.forEach(s),Cp=i(n),ts=c(n,"P",{});var sk=u(ts);al=p(sk,"이렇듯 데드락에 걸리거나 응답이 없는 고루틴이 있는 것 같다면, 해당 문제를 감지한 이후 스택 트레이스를 출력하는 방법은 꽤 유용할 것이다."),sk.forEach(s),xp=i(n),Dp=c(n,"BR",{}),Pp=i(n),xn=c(n,"P",{});var qp=u(xn);tl=p(qp,`race condition을 처리하는 건 더 어렵다.
좋은 방법 중 하나는 race condition이 발생하는 것으로 의심되는 부분을 찾아서 복제하고 유닛 테스트를 돌리는 것이다.
Go의 race detector(`),Aa=c(qp,"CODE",{});var ak=u(Aa);pl=p(ak,"-race"),ak.forEach(s),ol=p(qp,` 플래그)를 사용하면 된다.
race detector는 memory race를 관측하면 이를 보고한다.`),qp.forEach(s),Sp=i(n),ps=c(n,"P",{});var tk=u(ps);el=p(tk,"하지만 race detector는 race가 발생할 때만 감지할 수 있기 때문에, detector가 돌아갈 때 race가 발생하지 않았다고 해도 race가 발생하지 않는다고 속단할 수 없다."),tk.forEach(s),Op=i(n),W=c(n,"P",{});var ms=u(W);cl=p(ms,`race condition은 대부분 자료구조를 오염시키는 형태로 발생한다. 이를 해결하기 위해서는 자사 및 외부 라이브러리의 기나긴 코드 리딩 시간을 거쳐가게 될 것이다.
중간중간에 `),ha=c(ms,"CODE",{});var pk=u(ha);ll=p(pk,"fmt.Println"),pk.forEach(s),ul=p(ms,"이나 "),Ha=c(ms,"CODE",{});var ok=u(Ha);kl=p(ok,"panic"),ok.forEach(s),il=p(ms,"을 집어넣어서 어떤 상태인지 확인하는 것도 좋은 습관이다."),ms.forEach(s),Rp=i(n),Mp=c(n,"BR",{}),Bp=c(n,"BR",{}),Tp=i(n),Dn=c(n,"H2",{id:!0});var $l=u(Dn);Pn=c($l,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var ek=u(Pn);qa=c(ek,"SPAN",{class:!0}),u(qa).forEach(s),ek.forEach(s),rl=p($l,"References"),$l.forEach(s),Gp=i(n),Fp=c(n,"HR",{}),Lp=i(n),os=c(n,"CENTER",{});var ck=u(os);z=c(ck,"P",{});var Es=u(z);Fn=c(Es,"A",{href:!0,rel:!0});var lk=u(Fn);es=c(lk,"IMG",{src:!0,alt:!0}),lk.forEach(s),fl=i(Es),dl=c(Es,"BR",{}),ml=i(Es),Ln=c(Es,"A",{href:!0,rel:!0});var uk=u(Ln);El=p(uk,"Jon Bodner, 『Learning Go』, O’Reilly Media, Inc."),uk.forEach(s),Es.forEach(s),ck.forEach(s),this.h()},h(){d(ws,"class","icon icon-link"),d(tn,"aria-hidden","true"),d(tn,"tabindex","-1"),d(tn,"href","#stack-trace"),d(an,"id","stack-trace"),d(Mn,"class","language-text"),d(Gs,"class","icon icon-link"),d(ln,"aria-hidden","true"),d(ln,"tabindex","-1"),d(ln,"href","#실패-감지-및-복구"),d(cn,"id","실패-감지-및-복구"),d(As,"class","icon icon-link"),d(kn,"aria-hidden","true"),d(kn,"tabindex","-1"),d(kn,"href","#실패-감지"),d(un,"id","실패-감지"),d(Oa,"class","icon icon-link"),d(vn,"aria-hidden","true"),d(vn,"tabindex","-1"),d(vn,"href","#재시작"),d(_n,"id","재시작"),d(Ba,"class","icon icon-link"),d(bn,"aria-hidden","true"),d(bn,"tabindex","-1"),d(bn,"href","#디버깅"),d($n,"id","디버깅"),d(Bn,"class","language-go"),d(Tn,"class","language-go"),d(Gn,"class","language-go"),d(qa,"class","icon icon-link"),d(Pn,"aria-hidden","true"),d(Pn,"tabindex","-1"),d(Pn,"href","#references"),d(Dn,"id","references"),$k(es.src,bl="https://learning.oreilly.com/covers/urn:orm:book:9781804619070/400w/")||d(es,"src",bl),d(es,"alt","Effective Concurrency in Go"),d(Fn,"href","https://learning.oreilly.com/library/view/effective-concurrency-in/9781804619070/"),d(Fn,"rel","nofollow"),d(Ln,"href","https://learning.oreilly.com/library/view/effective-concurrency-in/9781804619070/"),d(Ln,"rel","nofollow")},m(n,o){l(n,r,o),a(r,E),l(n,f,o),l(n,m,o),l(n,Za,o),l(n,Ka,o),l(n,an,o),a(an,tn),a(tn,ws),a(an,Ip),l(n,Qa,o),l(n,Xa,o),l(n,Ya,o),l(n,Hn,o),a(Hn,Np),l(n,ga,o),Q(pn,n,o),l(n,nt,o),l(n,qn,o),a(qn,Wp),l(n,st,o),Q(on,n,o),l(n,at,o),l(n,P,o),a(P,jp),a(P,_s),a(_s,Up),a(P,Vp),a(P,vs),a(vs,Jp),a(P,zp),a(P,ys),a(ys,Zp),a(P,Kp),l(n,tt,o),l(n,S,o),a(S,Qp),a(S,$s),a($s,Xp),a(S,Yp),a(S,bs),a(bs,gp),a(S,no),a(S,Cs),a(Cs,so),a(S,ao),l(n,pt,o),l(n,O,o),a(O,to),a(O,xs),a(xs,po),a(O,oo),a(O,Ds),a(Ds,eo),a(O,co),a(O,Ps),a(Ps,lo),a(O,uo),l(n,ot,o),l(n,L,o),a(L,ko),a(L,Ss),a(Ss,io),a(L,ro),a(L,Os),a(Os,fo),a(L,mo),l(n,et,o),l(n,In,o),a(In,Eo),l(n,ct,o),Q(en,n,o),l(n,lt,o),l(n,Nn,o),a(Nn,wo),l(n,ut,o),l(n,Mn,o),Mn.innerHTML=kk,l(n,kt,o),l(n,b,o),a(b,_o),a(b,Rs),a(Rs,vo),a(b,yo),a(b,Ms),a(Ms,$o),a(b,bo),a(b,Bs),a(Bs,Co),a(b,xo),a(b,Ts),a(Ts,Do),a(b,Po),l(n,it,o),l(n,Wn,o),a(Wn,So),l(n,rt,o),l(n,jn,o),a(jn,Oo),l(n,ft,o),l(n,dt,o),l(n,mt,o),l(n,Et,o),l(n,cn,o),a(cn,ln),a(ln,Gs),a(cn,Ro),l(n,wt,o),l(n,_t,o),l(n,vt,o),l(n,Un,o),a(Un,Mo),l(n,yt,o),l(n,A,o),a(A,Bo),a(A,Fs),a(Fs,To),a(A,Go),a(A,Ls),a(Ls,Fo),a(A,Lo),l(n,$t,o),l(n,Vn,o),a(Vn,Ao),l(n,bt,o),l(n,Jn,o),a(Jn,ho),l(n,Ct,o),l(n,xt,o),l(n,Dt,o),l(n,un,o),a(un,kn),a(kn,As),a(un,Ho),l(n,Pt,o),l(n,h,o),a(h,qo),a(h,hs),a(hs,Io),a(h,No),a(h,Hs),a(Hs,Wo),a(h,jo),l(n,St,o),l(n,R,o),a(R,Uo),a(R,qs),a(qs,Vo),a(R,Jo),a(R,Is),a(Is,zo),a(R,Zo),a(R,Ns),a(Ns,Ko),a(R,Qo),l(n,Ot,o),l(n,B,o),a(B,Ws),a(Ws,Xo),a(B,Yo),a(B,js),a(js,go),a(B,ne),a(B,Us),a(Us,se),a(B,ae),l(n,Rt,o),l(n,zn,o),a(zn,te),l(n,Mt,o),Q(rn,n,o),l(n,Bt,o),l(n,fn,o),a(fn,pe),a(fn,Vs),a(Vs,oe),a(fn,ee),l(n,Tt,o),l(n,M,o),a(M,ce),a(M,Js),a(Js,le),a(M,ue),a(M,zs),a(zs,ke),a(M,ie),a(M,Zs),a(Zs,re),a(M,fe),l(n,Gt,o),Q(dn,n,o),l(n,Ft,o),l(n,V,o),a(V,Ks),a(Ks,de),a(V,me),a(V,Qs),a(Qs,Ee),a(V,we),l(n,Lt,o),l(n,_,o),a(_,Xs),a(Xs,_e),a(_,ve),a(_,Ys),a(Ys,ye),a(_,$e),a(_,gs),a(gs,be),a(_,Ce),a(_,na),a(na,xe),a(_,De),a(_,sa),a(sa,Pe),a(_,Se),a(_,aa),a(aa,Oe),a(_,Re),a(_,ta),a(ta,Me),a(_,Be),l(n,At,o),l(n,v,o),a(v,Te),a(v,pa),a(pa,Ge),a(v,Fe),a(v,oa),a(oa,Le),a(v,Ae),a(v,ea),a(ea,he),a(v,He),a(v,ca),a(ca,qe),a(v,Ie),a(v,la),a(la,Ne),a(v,We),a(v,ua),a(ua,je),a(v,Ue),l(n,ht,o),l(n,C,o),a(C,Ve),a(C,ka),a(ka,Je),a(C,ze),a(C,ia),a(ia,Ze),a(C,Ke),a(C,ra),a(ra,Qe),a(C,Xe),a(C,fa),a(fa,Ye),a(C,ge),l(n,Ht,o),l(n,qt,o),l(n,It,o),l(n,H,o),a(H,nc),a(H,da),a(da,sc),a(H,ac),a(H,ma),a(ma,tc),a(H,pc),l(n,Nt,o),Q(mn,n,o),l(n,Wt,o),l(n,En,o),a(En,oc),a(En,Ea),a(Ea,ec),a(En,cc),l(n,jt,o),l(n,T,o),a(T,wa),a(wa,lc),a(T,uc),a(T,_a),a(_a,kc),a(T,ic),a(T,va),a(va,rc),a(T,fc),l(n,Ut,o),l(n,y,o),a(y,ya),a(ya,dc),a(y,mc),a(y,$a),a($a,Ec),a(y,wc),a(y,ba),a(ba,_c),a(y,vc),a(y,Ca),a(Ca,yc),a(y,$c),a(y,xa),a(xa,bc),a(y,Cc),a(y,Da),a(Da,xc),a(y,Dc),l(n,Vt,o),l(n,Jt,o),l(n,zt,o),l(n,q,o),a(q,Pc),a(q,Pa),a(Pa,Sc),a(q,Oc),a(q,Sa),a(Sa,Rc),a(q,Mc),l(n,Zt,o),Q(wn,n,o),l(n,Kt,o),l(n,Zn,o),a(Zn,Bc),l(n,Qt,o),l(n,Xt,o),l(n,Yt,o),l(n,_n,o),a(_n,vn),a(vn,Oa),a(_n,Tc),l(n,gt,o),l(n,Kn,o),a(Kn,Gc),l(n,np,o),Q(yn,n,o),l(n,sp,o),l(n,I,o),a(I,Fc),a(I,Ra),a(Ra,Lc),a(I,Ac),a(I,Ma),a(Ma,hc),a(I,Hc),l(n,ap,o),l(n,tp,o),l(n,pp,o),l(n,op,o),l(n,$n,o),a($n,bn),a(bn,Ba),a($n,qc),l(n,ep,o),l(n,cp,o),l(n,lp,o),l(n,Qn,o),a(Qn,Ic),l(n,up,o),l(n,Xn,o),a(Xn,Nc),l(n,kp,o),l(n,N,o),a(N,Wc),a(N,Ta),a(Ta,jc),a(N,Uc),a(N,Ga),a(Ga,Vc),a(N,Jc),l(n,ip,o),Q(Cn,n,o),l(n,rp,o),l(n,Yn,o),a(Yn,zc),l(n,fp,o),l(n,Bn,o),Bn.innerHTML=ik,l(n,dp,o),l(n,gn,o),a(gn,Zc),l(n,mp,o),l(n,Ep,o),l(n,wp,o),l(n,ns,o),a(ns,Kc),l(n,_p,o),l(n,ss,o),a(ss,Qc),l(n,vp,o),l(n,Tn,o),Tn.innerHTML=rk,l(n,yp,o),l(n,J,o),a(J,Fa),a(Fa,Xc),a(J,Yc),a(J,La),a(La,gc),a(J,nl),l(n,$p,o),l(n,as,o),a(as,sl),l(n,bp,o),l(n,Gn,o),Gn.innerHTML=fk,l(n,Cp,o),l(n,ts,o),a(ts,al),l(n,xp,o),l(n,Dp,o),l(n,Pp,o),l(n,xn,o),a(xn,tl),a(xn,Aa),a(Aa,pl),a(xn,ol),l(n,Sp,o),l(n,ps,o),a(ps,el),l(n,Op,o),l(n,W,o),a(W,cl),a(W,ha),a(ha,ll),a(W,ul),a(W,Ha),a(Ha,kl),a(W,il),l(n,Rp,o),l(n,Mp,o),l(n,Bp,o),l(n,Tp,o),l(n,Dn,o),a(Dn,Pn),a(Pn,qa),a(Dn,rl),l(n,Gp,o),l(n,Fp,o),l(n,Lp,o),l(n,os,o),a(os,z),a(z,Fn),a(Fn,es),a(z,fl),a(z,dl),a(z,ml),a(z,Ln),a(Ln,El),Ap=!0},p(n,[o]){const cs={};o&1&&(cs.$$scope={dirty:o,ctx:n}),pn.$set(cs);const Ia={};o&1&&(Ia.$$scope={dirty:o,ctx:n}),on.$set(Ia);const Na={};o&1&&(Na.$$scope={dirty:o,ctx:n}),en.$set(Na);const Wa={};o&1&&(Wa.$$scope={dirty:o,ctx:n}),rn.$set(Wa);const G={};o&1&&(G.$$scope={dirty:o,ctx:n}),dn.$set(G);const ja={};o&1&&(ja.$$scope={dirty:o,ctx:n}),mn.$set(ja);const Ua={};o&1&&(Ua.$$scope={dirty:o,ctx:n}),wn.$set(Ua);const Va={};o&1&&(Va.$$scope={dirty:o,ctx:n}),yn.$set(Va);const F={};o&1&&(F.$$scope={dirty:o,ctx:n}),Cn.$set(F)},i(n){Ap||(X(pn.$$.fragment,n),X(on.$$.fragment,n),X(en.$$.fragment,n),X(rn.$$.fragment,n),X(dn.$$.fragment,n),X(mn.$$.fragment,n),X(wn.$$.fragment,n),X(yn.$$.fragment,n),X(Cn.$$.fragment,n),Ap=!0)},o(n){Y(pn.$$.fragment,n),Y(on.$$.fragment,n),Y(en.$$.fragment,n),Y(rn.$$.fragment,n),Y(dn.$$.fragment,n),Y(mn.$$.fragment,n),Y(wn.$$.fragment,n),Y(yn.$$.fragment,n),Y(Cn.$$.fragment,n),Ap=!1},d(n){n&&s(r),n&&s(f),n&&s(m),n&&s(Za),n&&s(Ka),n&&s(an),n&&s(Qa),n&&s(Xa),n&&s(Ya),n&&s(Hn),n&&s(ga),g(pn,n),n&&s(nt),n&&s(qn),n&&s(st),g(on,n),n&&s(at),n&&s(P),n&&s(tt),n&&s(S),n&&s(pt),n&&s(O),n&&s(ot),n&&s(L),n&&s(et),n&&s(In),n&&s(ct),g(en,n),n&&s(lt),n&&s(Nn),n&&s(ut),n&&s(Mn),n&&s(kt),n&&s(b),n&&s(it),n&&s(Wn),n&&s(rt),n&&s(jn),n&&s(ft),n&&s(dt),n&&s(mt),n&&s(Et),n&&s(cn),n&&s(wt),n&&s(_t),n&&s(vt),n&&s(Un),n&&s(yt),n&&s(A),n&&s($t),n&&s(Vn),n&&s(bt),n&&s(Jn),n&&s(Ct),n&&s(xt),n&&s(Dt),n&&s(un),n&&s(Pt),n&&s(h),n&&s(St),n&&s(R),n&&s(Ot),n&&s(B),n&&s(Rt),n&&s(zn),n&&s(Mt),g(rn,n),n&&s(Bt),n&&s(fn),n&&s(Tt),n&&s(M),n&&s(Gt),g(dn,n),n&&s(Ft),n&&s(V),n&&s(Lt),n&&s(_),n&&s(At),n&&s(v),n&&s(ht),n&&s(C),n&&s(Ht),n&&s(qt),n&&s(It),n&&s(H),n&&s(Nt),g(mn,n),n&&s(Wt),n&&s(En),n&&s(jt),n&&s(T),n&&s(Ut),n&&s(y),n&&s(Vt),n&&s(Jt),n&&s(zt),n&&s(q),n&&s(Zt),g(wn,n),n&&s(Kt),n&&s(Zn),n&&s(Qt),n&&s(Xt),n&&s(Yt),n&&s(_n),n&&s(gt),n&&s(Kn),n&&s(np),g(yn,n),n&&s(sp),n&&s(I),n&&s(ap),n&&s(tp),n&&s(pp),n&&s(op),n&&s($n),n&&s(ep),n&&s(cp),n&&s(lp),n&&s(Qn),n&&s(up),n&&s(Xn),n&&s(kp),n&&s(N),n&&s(ip),g(Cn,n),n&&s(rp),n&&s(Yn),n&&s(fp),n&&s(Bn),n&&s(dp),n&&s(gn),n&&s(mp),n&&s(Ep),n&&s(wp),n&&s(ns),n&&s(_p),n&&s(ss),n&&s(vp),n&&s(Tn),n&&s(yp),n&&s(J),n&&s($p),n&&s(as),n&&s(bp),n&&s(Gn),n&&s(Cp),n&&s(ts),n&&s(xp),n&&s(Dp),n&&s(Pp),n&&s(xn),n&&s(Sp),n&&s(ps),n&&s(Op),n&&s(W),n&&s(Rp),n&&s(Mp),n&&s(Bp),n&&s(Tp),n&&s(Dn),n&&s(Gp),n&&s(Fp),n&&s(Lp),n&&s(os)}}}const Fk={title:"동시성 문제 해결하기",date:"2023-10-03T00:00:00.000Z",excerpt:"동시성 문제가 해결하기 그렇게 어렵다던데",categories:["Golang","Concurrency in Go"],coverImage:"/post_img/Go/Concurrency in Go/cover.png",coverWidth:16,coverHeight:9,indexed:!1,exposed:!0};class Lk extends _k{constructor(r){super(),vk(this,r,null,Bk,yk,{})}}export{Lk as default,Fk as metadata};
