{"type":"data","nodes":[null,{"type":"data","data":[{"PostContent":1,"meta":2},"\u003Cp\u003EGolang으로 하는 첫 프로젝트로, WebRTC many-to-many 시그널링 서버를 만들게 되었다.\u003C\u002Fp\u003E\n\u003Ch2 id=\"basic-11-signaling\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#basic-11-signaling\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EBasic 1:1 Signaling\u003C\u002Fh2\u003E\n\u003Cp\u003E우선 가장 기본적인 예제인, 1:1 연결 시그널링 서버의 예제부터 구현하였다. 1:1 시그널링 서버는 언어를 막론하고 예제가 많이 존재한다.\n본인 또한 참고한 예제가 있다. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fshanet\u002FWebRTC-Example\" rel=\"nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fshanet\u002FWebRTC-Example\u003C\u002Fa\u003E의 예제를 확인하면 간단한 웹 클라이언트와, Node.js 및 WebSocket 기반의 간단한 시그널링 서버를 찾아볼 수 있다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E서버쪽 소스코드는 너무나도 간단하다. ICE나 SDP 등 WebRTC 연결 정보를 전달해주는 역할을 하는 코드는 이 정도밖에 안된다.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-javascript\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-javascript\"\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E wss \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EWebSocketServer\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\"token literal-property property\"\u003Eserver\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E httpsServer \u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\nwss\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Eon\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'connection'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Ews\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Eon\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'message'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Emessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token comment\"\u003E\u002F\u002F Broadcast any received message to all clients\u003C\u002Fspan\u003E\n\t\tconsole\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'received: %s'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E message\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\t\twss\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Ebroadcast\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Emessage\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\nwss\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function-variable function\"\u003Ebroadcast\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Edata\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eclients\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EforEach\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Eclient\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eclient\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EreadyState \u003Cspan class=\"token operator\"\u003E===\u003C\u002Fspan\u003E WebSocket\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token constant\"\u003EOPEN\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\tclient\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Esend\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E한쪽 피어가 보낸 메시지를 다른 피어한테 웹소켓을 통해 전송해주는 로직으로, 사실상 채팅 서버와 거의 동일하다고 볼 수 있다.\n그래서 Go로 작성된 웹소켓 기반 채팅서버 예제를 참조하여 금방 시그널링 서버를 구현할 수 있었다.\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjos-\u002Fgofiber-websocket-chat-example\" rel=\"nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fjos-\u002Fgofiber-websocket-chat-example\u003C\u002Fa\u003E의 예제를 참조하여 동일 클라이언트 코드를 사용하는 Go 예제로 옮겨보았다.\u003C\u002Fp\u003E\n\u003Cp\u003E프로젝트는 \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgofiber\u002Ffiber\" rel=\"nofollow\"\u003EGoFiber\u003C\u002Fa\u003E의 \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgofiber\u002Fwebsocket\" rel=\"nofollow\"\u003E웹소켓 extension\u003C\u002Fa\u003E을 사용하여 진행하였다.\n웹소켓 관련 Go 라이브러리 중에서 가장 일반적으로 사용되는 게 \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgorilla\u002Fwebsocket\" rel=\"nofollow\"\u003EGorilla WebSocket\u003C\u002Fa\u003E으로 알고 있는데, 2022년 12월 쯤 Gorilla WebSocket의 깃허브 레포지토리가 archived 상태가 되었다.\n괜찮은 대체제를 찾는 겸, Fiber 연습하는 겸 GoFiber WebSocket extension를 사용하게 되었다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E먼저, 다음과 같이 유저가 접속하거나 나갈 때 데이터를 전송할 채널과, 채널에 들어온 데이터를 받아서 처리할 고루틴을 작성해주었다.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-go\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-go\"\u003E\u003Cspan class=\"token keyword\"\u003Etype\u003C\u002Fspan\u003E channelSet \u003Cspan class=\"token keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tregister   \u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\n\tunregister \u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\n\tbroadcast  \u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Estring\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Etype\u003C\u002Fspan\u003E client \u003Cspan class=\"token keyword\"\u003Estruct\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E clients \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emake\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003Eclient\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EsendBroadcastMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ecs \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EchannelSet\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E message \u003Cspan class=\"token builtin\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Efor\u003C\u002Fspan\u003E c \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Erange\u003C\u002Fspan\u003E clients \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E c\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EWriteMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ETextMessage\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Ebyte\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Emessage\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"write error: err\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\tc\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EWriteMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECloseMessage\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token builtin\"\u003Ebyte\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\tc\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EClose\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EuserHub\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ecs \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EchannelSet\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Eselect\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Ecase\u003C\u002Fspan\u003E registerUser \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;-\u003C\u002Fspan\u003Ecs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eregister\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n\t\t\tclients\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003EregisterUser\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E client\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"new client is connected\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\t\t\u003Cspan class=\"token keyword\"\u003Ecase\u003C\u002Fspan\u003E unregisterUser \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;-\u003C\u002Fspan\u003Ecs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eunregister\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token function\"\u003Edelete\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eclients\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E unregisterUser\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"connection terminated\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EmessageHub\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ecs \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EchannelSet\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Eselect\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Ecase\u003C\u002Fspan\u003E message \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;-\u003C\u002Fspan\u003Ecs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Ebroadcast\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n\t\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"message received\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token function\"\u003EsendBroadcastMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ecs\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E message\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E channels \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E channelSet\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\tregister\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E   \u003Cspan class=\"token function\"\u003Emake\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\tunregister\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emake\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\tbroadcast\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E  \u003Cspan class=\"token function\"\u003Emake\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"token keyword\"\u003Ego\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EuserHub\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E&amp;\u003C\u002Fspan\u003Echannels\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Ego\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EmessageHub\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E&amp;\u003C\u002Fspan\u003Echannels\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"token operator\"\u003E...\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E각각 \u003Ccode\u003Eregister\u003C\u002Fcode\u003E 채널에 유저 정보가 입력되면 유저를 전역변수 \u003Ccode\u003Eclients\u003C\u002Fcode\u003E에 추가하고, \u003Ccode\u003Eunregister\u003C\u002Fcode\u003E 채널에 입력되면 유저를 제거한다. \u003Ccode\u003Ebroadcast\u003C\u002Fcode\u003E 채널에 메시지가 입력되면 메시지를 모든 유저에게 전달한다.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode\u003E*ws.Conn\u003C\u002Fcode\u003E 타입의 인스턴스는 각 웹소켓 클라이언트에 해당하는 것으로, \u003Ccode\u003E*ws.Conn\u003C\u002Fcode\u003E의 \u003Ccode\u003EReadMessage()\u003C\u002Fcode\u003E 등을 호출하여 데이터를 읽거나 쓸 수 있다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E유저의 웹소켓 세션에 관련된 부분은 다음과 같다.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-go\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-go\"\u003E\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token operator\"\u003E...\u003C\u002Fspan\u003E\n\n\tapp\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EGet\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"\u002Fws\u002F\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ec \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Efiber\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECtx\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EIsWebSocketUpgrade\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ec\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\tc\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003ENext\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\t\t\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\t\tws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003ENew\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ec \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\u003Cspan class=\"token keyword\"\u003Edefer\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\tchannels\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eunregister \u003Cspan class=\"token operator\"\u003E&lt;-\u003C\u002Fspan\u003E c\n\t\t\t\t\tc\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EClose\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\t\t\t\tchannels\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Eregister \u003Cspan class=\"token operator\"\u003E&lt;-\u003C\u002Fspan\u003E c\n\n\t\t\t\t\u003Cspan class=\"token keyword\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\tmessageType\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E message\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E c\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EReadMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EIsUnexpectedCloseError\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eerr\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECloseGoingAway\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECloseAbnormalClosure\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"read error:\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E err\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\t\t\t\t\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E\n\t\t\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\t\t\t\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E messageType \u003Cspan class=\"token operator\"\u003E==\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ETextMessage \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\t\tchannels\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Ebroadcast \u003Cspan class=\"token operator\"\u003E&lt;-\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Emessage\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\t\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"websocket message recived of type\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E messageType\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E먼저 웹소켓을 사용할 수 있는지 검사한 후, 사용 가능하다면 웹소켓 연결을 생성한다.\n웹소켓 연결이 생성되면 \u003Ccode\u003Eregister\u003C\u002Fcode\u003E 채널에 클라이언트 정보를 보내고, defer문을 통해 클라이언트가 웹소켓 연결을 끊으면 \u003Ccode\u003Eunregister\u003C\u002Fcode\u003E 채널에 클라이언트 정보를 보낼 수 있게끔 하였다.\u003C\u002Fp\u003E\n\u003Cp\u003E1:1 연결에서는 이러한 100줄 정도의 코드만으로도 시그널링 서버를 구현할 수 있다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E전체 코드는 \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjunhyuk0801\u002Fwebrtc-mesh-server\u002Ftree\u002F5d435d745a48ba3be0c1299163029364ec31a3bf\" rel=\"nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fjunhyuk0801\u002Fwebrtc-mesh-server\u002Ftree\u002F5d435d745a48ba3be0c1299163029364ec31a3bf\u003C\u002Fa\u003E에서 찾아볼 수 있다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\u003Cbr\u003E\n\u003Ch2 id=\"개선할-점\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#개선할-점\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E개선할 점\u003C\u002Fh2\u003E\n\u003Cp\u003E일단 M:M으로 나아가기에 앞서, 위 예제에서 몇 가지 문제점을 찾아볼 수 있다.\u003C\u002Fp\u003E\n\u003Cul\u003E\u003Cli\u003E서버가 1:1 연결 하나만 처리할 수 있음… 세션 정도는 만들어줄 필요가 있음.\u003C\u002Fli\u003E\n\u003Cli\u003E클라이언트 코드도 마찬가지로 상대방이 한 명이라고 가정하여 작성되어 있음. 여러 명의 유저와 통신할 수 있게끔 수정해야 함.\u003C\u002Fli\u003E\n\u003Cli\u003E유저가 나갈 때에 대한 처리가 부족함. 한 유저가 나가면 \u003Ccode\u003ERTCPeerConnection\u003C\u002Fcode\u003E을 통해 유저가 나갔다는 사실을 전달받을 수 있겠지만, 그걸 통해 \u003Ccode\u003E&lt;video&gt;\u003C\u002Fcode\u003E element를 지운다던지 하는 처리가 전혀 없음.\u003C\u002Fli\u003E\n\u003Cli\u003E고루틴을 여러 개 띄워서 전역 변수인 \u003Ccode\u003Eclient\u003C\u002Fcode\u003E에 읽기\u002F쓰기를 시도하는 반면, \u003Ccode\u003Eclient\u003C\u002Fcode\u003E는 뮤텍스 등을 통해 보호되지 않음. 이 때문에 새로고침을 막 눌러서 연결을 빡세게 시도하면 data race로 인한 panic이 일어나서 서버가 곧잘 죽는 것을 확인할 수 있음\u003C\u002Fli\u003E\n\u003Cli\u003E모든 컴포넌트가 \u003Ccode\u003Emain.go\u003C\u002Fcode\u003E 한 파일에 몰려있음. 리팩토링을 통해 디커플링하는 겸 변수 이름도 Convention에 맞게 다시 지어주면 좋을 듯 함.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\u003Cp\u003E또한 Mesh 형태의 many-to-many 연결을 구현하기 위해서는 시그널링 서버에서 특정 유저한테만 메시지를 보낼 수 있는 방법이 추가되어야 한다. WebRTC 연결을 생성하려는 대상이 아닌 다른 대상에게까지 메시지가 전달되면 오류가 발생하여 연결 설정이 제대로 안될 수 있기 때문이다.\u003C\u002Fp\u003E\n\u003Cp\u003E다음으로 다룰 예제에서 위 사항을 충족시킨 코드를 확인할 수 있을 것이다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\u003Cbr\u003E\n\u003Ch2 id=\"many-to-many-mesh-server\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#many-to-many-mesh-server\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EMany-to-Many Mesh Server\u003C\u002Fh2\u003E\n\u003Cp\u003E코드를 보면서 설명하는 게 빠를 듯 하다.\u003C\u002Fp\u003E\n\u003Cp\u003E일단 \u003Ccode\u003Emain.go\u003C\u002Fcode\u003E의 변경사항이다.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-go\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-go\"\u003E\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tclientDataStore \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EMakeClientDataStore\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\thub \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003ECreateHub\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EclientDataStore\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"token operator\"\u003E...\u003C\u002Fspan\u003E\n\n\tapp\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EGet\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"\u002Fws\u002F:session\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ec \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Efiber\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECtx\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\"token comment\"\u003E\u002F\u002F check if a client can establish websocket connection\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EIsWebSocketUpgrade\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ec\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\tc\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003ENext\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\tws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003ENew\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Econn \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token function\"\u003EWebsocketConnectionLoop\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EclientDataStore\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E hub\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E conn\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E우선, 이전에 전역변수로 선언되던 \u003Ccode\u003Eclients\u003C\u002Fcode\u003E를 로컬변수로 선언하여 \u003Ccode\u003EHub\u003C\u002Fcode\u003E를 생성할 때 전달하도록 하였다.\n또한 클라이언트별 웹소켓 루프를 별도의 함수로 지정하였다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E웹소켓 루프 함수를 살펴보자.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-go\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-go\"\u003E\u003Cspan class=\"token comment\"\u003E\u002F\u002F Websocket Session Loop for each client\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EWebsocketConnectionLoop\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ecds \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EClientDataStore\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E hub \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EMessageHub\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E conn \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tsession \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003ESessionName\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EParams\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"session\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\tjoinMessage\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E uuid\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EgetUUID\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"an error occured getting uuid:\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E err\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\tconn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EClose\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintf\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"user %s joined on %s&#92;n\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E uuid\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E session\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\thub\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003ESendBroadcastMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Esession\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E uuid\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E joinMessage\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token comment\"\u003E\u002F\u002F broadcast current users uuid\u003C\u002Fspan\u003E\n\n\tclient \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E Client\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E conn\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\thub\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003ERegisterUser\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Esession\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E uuid\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E client\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token comment\"\u003E\u002F\u002F add current user's information to users list\u003C\u002Fspan\u003E\n\n\terr \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EsendUserList\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ecds\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E conn\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E session\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token comment\"\u003E\u002F\u002F send users list to user\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"an error occured sending user list:\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E err\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\tconn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EClose\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"token keyword\"\u003Edefer\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\"token comment\"\u003E\u002F\u002F when user leaves\u003C\u002Fspan\u003E\n\t\thub\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003ESendBroadcastMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Esession\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E uuid\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EcreateLeaveMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Euuid\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token comment\"\u003E\u002F\u002F broadcast current users uuid\u003C\u002Fspan\u003E\n\t\thub\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EUnregisterUser\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Esession\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E uuid\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E client\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E                         \u003Cspan class=\"token comment\"\u003E\u002F\u002F delete current user's information from users list\u003C\u002Fspan\u003E\n\t\tconn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EClose\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"token keyword\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E messageData MessageData\n\t\terr \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E conn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EReadJSON\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E&amp;\u003C\u002Fspan\u003EmessageData\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EIsUnexpectedCloseError\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eerr\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECloseGoingAway\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E ws\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECloseAbnormalClosure\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"read error:\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E err\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\t\thub\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003ESendSignallingMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Esession\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E uuid\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E messageData\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E클라이언트가 접속하면 자신의 UUID를 보낸다. 이 메시지는 동일한 세션 내의 다른 모든 유저들에게 브로드캐스트되며, 접속한 클라이언트에게는 해당 세션에 속한 다른 모든 클라이언트들의 UUID 목록을 보내준다. 클라이언트는 UUID 목록을 통해 각 유저별 WebRTC 연결을 생성한다.\u003C\u002Fp\u003E\n\u003Cp\u003E접속을 종료할 때도 클라이언트가 세션을 나간다는 메시지가 남아 있는 유저들에게 브로드캐스트된다.\u003C\u002Fp\u003E\n\u003Cp\u003E이러한 handshaking 과정을 거친 후, ICE나 SDP 등 시그널링 메시지를 처리하는 단계로 진입한다. \u003Ccode\u003ESendSignallingMessage()\u003C\u002Fcode\u003E 메소드를 통해 UUID로 구분하여 특정 대상에게 시그널링 메시지를 전달할 수 있다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E다음으로, \u003Ccode\u003EClientDataStore\u003C\u002Fcode\u003E에 대해 살펴보자.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-go\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-go\"\u003E\u003Cspan class=\"token comment\"\u003E\u002F\u002F Client struct type. you can add any data here\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Etype\u003C\u002Fspan\u003E Client \u003Cspan class=\"token keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tconn \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EConn\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F Datastore of client\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Etype\u003C\u002Fspan\u003E ClientDataStore \u003Cspan class=\"token keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tmutex     sync\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ERWMutex\n\tdataStore \u003Cspan class=\"token keyword\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003ESessionName\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003EUUIDType\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003EClient\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F Create new datastore\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EMakeClientDataStore\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EClientDataStore \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&amp;\u003C\u002Fspan\u003EClientDataStore\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\tdataStore\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emake\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003ESessionName\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003EUUIDType\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003EClient\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Ccode\u003EClientDataStore\u003C\u002Fcode\u003E는 세션별 유저들의 정보가 저장되는 자료구조로, \u003Ccode\u003EGetSessionData()\u003C\u002Fcode\u003E, \u003Ccode\u003EForEachUser()\u003C\u002Fcode\u003E, \u003Ccode\u003EGetClientData()\u003C\u002Fcode\u003E, \u003Ccode\u003ESetUserData()\u003C\u002Fcode\u003E, \u003Ccode\u003EDeleteUserData()\u003C\u002Fcode\u003E 메소드를 통해 접근할 수 있다.\n\u003Ccode\u003ERWMutex\u003C\u002Fcode\u003E를 설정하여 여러 고루틴에서 동시에 접근하여 생길 수 있는 Data race 문제를 해결하였다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E마지막으로 채널의 데이터를 처리하는 \u003Ccode\u003EHub\u003C\u002Fcode\u003E쪽을 살펴보자.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-go\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\"language-go\"\u003E\u003Cspan class=\"token operator\"\u003E...\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F Message data protocol\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Etype\u003C\u002Fspan\u003E MessageData \u003Cspan class=\"token keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tType    \u003Cspan class=\"token builtin\"\u003Estring\u003C\u002Fspan\u003E      \u003Cspan class=\"token string\"\u003E&#96;json:\"type\"&#96;\u003C\u002Fspan\u003E\n\tData    \u003Cspan class=\"token keyword\"\u003Einterface\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E&#96;json:\"data\"&#96;\u003C\u002Fspan\u003E\n\tSrcUUID UUIDType    \u003Cspan class=\"token string\"\u003E&#96;json:\"srcuuid\"&#96;\u003C\u002Fspan\u003E\n\tDstUUID UUIDType    \u003Cspan class=\"token string\"\u003E&#96;json:\"dstuuid\"&#96;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F Set of channels\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Etype\u003C\u002Fspan\u003E Hub \u003Cspan class=\"token keyword\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tregister   \u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E UserInfo\n\tunregister \u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E UserInfo\n\tbroadcast  \u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E MessageInfo\n\tsignaling  \u003Cspan class=\"token keyword\"\u003Echan\u003C\u002Fspan\u003E MessageInfo\n\tdatastore  \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EClientDataStore\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F Send broadcast message to every user in session\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EsendBroadcastMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ecds \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EClientDataStore\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E mi MessageInfo\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\terr \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E cds\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EForEachUser\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Emi\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ESession\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Euuid UUIDType\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E client Client\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E uuid \u003Cspan class=\"token operator\"\u003E!=\u003C\u002Fspan\u003E mi\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EUUID \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\terr \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E client\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EWriteJSON\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Emi\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMessage\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\t\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"write error:\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E err\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\tclient\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EWriteMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECloseMessage\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token builtin\"\u003Ebyte\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\tclient\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EClose\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\t\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E err\n\t\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\t\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E err\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F Send signaling message to specific user in session\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EsendSignalingMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ecds \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EClientDataStore\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E mi MessageInfo\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tclient \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E cds\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EGetClientData\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Emi\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ESession\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E mi\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMessage\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EDstUUID\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\terr \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E client\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EWriteJSON\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Emi\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EMessage\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E err \u003Cspan class=\"token operator\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\tfmt\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EPrintln\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E\"write error:\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E err\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\tclient\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EWriteMessage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ews\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003ECloseMessage\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token builtin\"\u003Ebyte\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\tclient\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Econn\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EClose\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\t\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E err\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Enil\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token operator\"\u003E...\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F Create new hub\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003ECreateHub\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eclients \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EClientDataStore\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003EHub \u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\tregisterChannel\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E unregisterChannel \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003ErunUserHub\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eclients\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\tbroadcastChannel\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E signalingChannel \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003ErunMessageHub\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eclients\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\thub \u003Cspan class=\"token operator\"\u003E:=\u003C\u002Fspan\u003E Hub\u003Cspan class=\"token punctuation\"\u003E&#123;\u003C\u002Fspan\u003E\n\t\tregister\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E   registerChannel\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\tunregister\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E unregisterChannel\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\tbroadcast\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E  broadcastChannel\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\tsignaling\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E  signalingChannel\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\tdatastore\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E  clients\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\t\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\t\u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&amp;\u003C\u002Fspan\u003Ehub\n\u003Cspan class=\"token punctuation\"\u003E&#125;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token operator\"\u003E...\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E이외의 부분은 충분히 직관적이거나 1:1 예제에서 크게 변동이 없는 부분이라 생략하였다.\n주목할 점은 메세지 데이터의 프로토콜을 \u003Ccode\u003EMessageData\u003C\u002Fcode\u003E로 정의하였다는 점과, 브로드캐스트 메시지와 시그널링 메시지를 전송하는 방법에 차이가 있다는 것이다.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode\u003EsendSignalingMessage()\u003C\u002Fcode\u003E의 경우 세션 정보와 UUID 클라이언트 데이터를 얻어와서 해당 클라이언트에게 메시지를 보낸다.\n한편, \u003Ccode\u003EsendBroadcastMessage()\u003C\u002Fcode\u003E의 경우 \u003Ccode\u003EForEachUser()\u003C\u002Fcode\u003E를 사용하여 세션의 모든 클라이언트에게 메시지를 보낸다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E전체 코드는 \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjunhyuk0801\u002Fwebrtc-mesh-server\" rel=\"nofollow\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fjunhyuk0801\u002Fwebrtc-mesh-server\u003C\u002Fa\u003E에서 찾아볼 수 있다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\u003Cbr\u003E\n\u003Ch2 id=\"이후의-작업\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#이후의-작업\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E이후의 작업\u003C\u002Fh2\u003E\n\u003Cp\u003E한 세션의 데이터를 읽기\u002F쓰기 중인 상황이더라도 다른 세션의 클라이언트는 그 세션의 데이터에 접근할 일이 없다.\n그래서 지금과 같이 공통의 뮤텍스 하나를 걸어놓기보다는, 각 세션별로 뮤텍스를 분리해 놓는 게 성능 향상을 이끌어낼 수 있을 것이다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\n\u003Cp\u003E\u003Ccode\u003EForEachUser()\u003C\u002Fcode\u003E에는 이터레이션을 도는 도중 데이터가 수정되지 않게끔 하기 위해 뮤텍스가 걸려 있지만, 이러한 방식에는 잠재적인 문제가 있다. 아무래도 웹소켓 메시지를 보내는 오버헤드가 비교적 큰 편이니, 이터레이션을 도는 과정 전체에 뮤텍스를 걸어놓으면 성능이 뚝뚝 떨어질 것이다.\u003C\u002Fp\u003E\n\u003Cp\u003E대안으로는 \u003Ccode\u003EGetSessionData()\u003C\u002Fcode\u003E로 세션 정보를 받아와서 이터레이션을 도는 방법도 있겠다. 이 방법을 사용하면 이터레이션을 도는 도중 데이터가 수정될 수도 있고, 그러한 수정 사항이 이터레이션에는 반영되지 않는다. 즉, 일관성이 깨지는 것이다.\u003C\u002Fp\u003E\n\u003Cp\u003E어찌 보면 데이터 일관성과 성능 사이에서 고민을 하다가 일관성을 택한 셈이다.\n만약 퍼포먼스 튜닝으로 성능을 끌어올려야 하는 상황이라면 \u003Ccode\u003EGetSessionData()\u003C\u002Fcode\u003E로 세션 정보를 받아와서 이터레이션을 돌되, 다른 방법으로 데이터 일관성에 신경써 주는 게 좋겠다.\n지금 생각해보니 후자의 방법이 더 나은것 같은데 왜 전자의 방법으로 했는지 잘 기억이 안난다. 코드를 졸릴 때 짜서 그런가보다.\u003C\u002Fp\u003E\n\u003Cbr\u003E\u003Cbr\u003E\n\u003Ch2 id=\"후기\"\u003E\u003Ca aria-hidden=\"true\" tabindex=\"-1\" href=\"#후기\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E후기\u003C\u002Fh2\u003E\n\u003Cp\u003Emany-to-many 만들 때 시그널링 메시지를 브로드캐스팅으로 보내버려서 피어 수가 3명이 넘어가면 연결이 제대로 안됐었는데, 뭐가 문제인지 찾는 데 한참 걸렸다.\u003C\u002Fp\u003E\n\u003Cp\u003E개인적으로 WebRTC 좀 친다고 생각했었는데 아직 갈 길이 먼 것 같다..\u003C\u002Fp\u003E",{"title":3,"date":4,"excerpt":5,"categories":6,"coverImage":10,"coverWidth":11,"coverHeight":12,"slug":13},"Golang으로 WebRTC Mesh Server 구현하기","2023-02-18T00:00:00.000Z","Golang을 통해 M:N WebRTC 시그널링 서버를 만들어보았습니다",[7,8,9],"WebRTC","Golang","Signaling Server","\u002Fpost_img\u002FWebRTC\u002Fcover.png",16,9,"Networking\u002FWebRTC\u002Fmany to many signaling server"],"uses":{"params":["post"]}}]}